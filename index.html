<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Stay Hungry. Stay Foolish.">
<meta property="og:type" content="website">
<meta property="og:title" content="WarriorYu">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="WarriorYu">
<meta property="og:description" content="Stay Hungry. Stay Foolish.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WarriorYu">
<meta name="twitter:description" content="Stay Hungry. Stay Foolish.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>WarriorYu</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">WarriorYu</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">山中莫道无供给，明月清风不用钱</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/Android技术小Tip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WarriorYu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WarriorYu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/Android技术小Tip/" itemprop="url">Android技术小Tip</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T11:39:37+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li><p>LinearLayout等空间在布局的根节点设置margin无效，padding有效。</p>
</li>
<li><p>CheckBox</p>
<ul>
<li>自定义样式使用<code>android:button=&quot;@drawable/selector_edit_activity_checkbox&quot;</code>，但是paddingLeft设置的是图片与文字的间距，不是左间距，可以通过marginLeft设置左间距。</li>
<li>如果只需要更改CheckBox的颜色，可以使用<code>android:buttonTint=&quot;@color/black&quot;</code>,但是有个版本的限制条件：<strong>Attribute buttonTint is only used in API level 21</strong></li>
<li>CheckBox 如果在代码中设置了 <code>cbxCheck.setOnClickListener(new View.OnClickListener(){}</code> 会导致没有点击后的涟漪效果</li>
</ul>
</li>
<li><p>Imageview 的tint属性：<strong>可以将图片的背景色改为想要的颜色</strong></p>
<ul>
<li><p>在xml文件中 <code>android:tint=&quot;@color/white&quot;</code></p>
</li>
<li><p>在java代码中 <code>imagview.setColorFilter(color);</code></p>
</li>
<li><p>扩展</p>
<p>How to apply the color. The standard mode is{@link PorterDuff.Mode#SRC_ATOP}</p>
<p><code>setColorFilter(int color, PorterDuff.Mode mode)</code></p>
</li>
</ul>
</li>
<li><p>前后台接口里的字段类型一定一致，否则会出现不可预知的bug:</p>
<ul>
<li>如果后台字段是String类型，前台是long类型，如果后台传了null，可能会导致奔溃，如果后台是long类型，不会出现null,即使没有这个字段，前台也会有默认值，减少崩溃率。不要每个字段判空，这是最low的，会导致项目里全是if else.</li>
</ul>
</li>
<li><p>如果想下载的sdk不能通过代理下载，注意在gradle.properties文件里，把相关代码删除或者注释。</p>
<p>报错信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Unable to resolve dependency for &apos;:app@debug/compileClasspath&apos;: Could not resolve com.mob:MobTools:+.</span><br><span class="line"></span><br><span class="line">Could not resolve com.mob:MobTools:+.</span><br><span class="line">Required by:</span><br><span class="line">    project :app</span><br><span class="line"> &gt; Could not resolve com.mob:MobTools:+.</span><br><span class="line">    &gt; Failed to list versions for com.mob:MobTools.</span><br><span class="line">          &gt; Unable to load Maven meta-data from http://jcenter.bintray.com/com/mob/MobTools/maven-metadata.xml.</span><br><span class="line">                   &gt; Could not get resource &apos;http://jcenter.bintray.com/com/mob/MobTools/maven-metadata.xml&apos;.</span><br><span class="line">                               &gt; Could not GET &apos;http://jcenter.bintray.com/com/mob/MobTools/maven-metadata.xml&apos;.</span><br><span class="line">                                              &gt; Connect to 127.0.0.1:1080 [/127.0.0.1] failed: Connection refused (Connection refused)</span><br><span class="line">                                                                &gt; Connection refused (Connection refused)</span><br></pre></td></tr></table></figure>
<p>解决方式：关闭代理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">android.enableAapt2=false</span><br><span class="line">#如果需要代理把这两行放开</span><br><span class="line">#systemProp.http.proxyHost=127.0.0.1</span><br><span class="line">#systemProp.http.proxyPort=1080</span><br><span class="line">org.gradle.jvmargs=-Xmx2048m -XX\:MaxPermSize\=512m -XX\:+HeapDumpOnOutOfMemoryError -Dfile.encoding\=UTF-8</span><br><span class="line">org.gradle.daemon=true</span><br><span class="line">org.gradle.configureondemand=true</span><br><span class="line">org.gradle.parallel=true</span><br><span class="line">android.useDeprecatedNdk=true</span><br></pre></td></tr></table></figure>
</li>
<li><p>RecyclerView等列表控件，如果获取position的item时要注意有header和没有header的情况，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">以BaseRecyclerViewAdapterHelper 这个库举例：</span><br><span class="line"></span><br><span class="line">//因为有addHeaderView,所以position的计算一定不能少了减去getHeaderLayoutCount()</span><br><span class="line">  int position = mViewHolder.get(i).getLayoutPosition() - getHeaderLayoutCount();</span><br></pre></td></tr></table></figure>
</li>
<li><p>Recyclerview:adapter.notifyDataSetChanged()类似的刷新方法，会引起已缓存的ViewHolder相应的onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int position)方法的调用，因为复用，并不会把整个列表都刷新一遍</p>
</li>
<li><p>代码压缩、混淆相关 ：参见：<a href="https://developer.android.com/studio/build/shrink-code?hl=zh-cn" target="_blank" rel="noopener">https://developer.android.com/studio/build/shrink-code?hl=zh-cn</a></p>
</li>
<li><p>TextView的自动适应文字大小属性：app:autoSizeTextType=”uniform”兼容到API14，</p>
<p>如果android:autoSizeTextType=”uniform”不能兼容Android 8.0以下的手机。和android:singleLine不兼容，会显示“…”,可以使用android:maxLines=“1” 。width和height要写死，否则在Recyclerview中滑动的时候，可能会导致缩放不符合预期。</p>
</li>
<li><p>抽象类A实现接口B，A可以实现B中的部分方法，也可以全部实现。</p>
</li>
<li><p>音频详情问题：1.为什么PendingIntent的数据没有传过来。是序列化的问题，改为传递基本类型 2.为什么在initViews()调用finish方法，还会走到fillData();</p>
</li>
<li><p>沉浸式状态栏，根布局”android:fitsSystemWindows”的影响要注意。</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/音视频开发分享-星陨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WarriorYu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WarriorYu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/音视频开发分享-星陨/" itemprop="url">音视频开发分享(星陨)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T11:37:10+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂谈/" itemprop="url" rel="index">
                    <span itemprop="name">杂谈</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="星陨：音视频开发分享"><a href="#星陨：音视频开发分享" class="headerlink" title="星陨：音视频开发分享"></a>星陨：音视频开发分享</h2><ol>
<li><p>音视频开发主要是做什么</p>
<ul>
<li>音视频采集<ul>
<li>Camera相关</li>
</ul>
</li>
<li>编码与解码<ul>
<li>FFmpeg相关<ul>
<li>视频编解码、合成、压缩</li>
</ul>
</li>
</ul>
</li>
<li>渲染<ul>
<li>特效相关，美颜滤镜、算法等</li>
</ul>
</li>
</ul>
</li>
<li><p>如何点亮音视频技能树</p>
<p>IOS掌握好Fundation就足够入门了</p>
<p>Android：</p>
<ul>
<li>学习Android上的音视频API</li>
<li>学习OpenGL渲染与FFmpeg</li>
<li>学习开源项目源码</li>
</ul>
<p>OpenGL学习了之后，该怎么做？</p>
<ul>
<li>OpenGL在音视频中的作用<ul>
<li>FFmpeg-&gt;OpenGL-&gt;Screen</li>
</ul>
</li>
<li>OpenGL算是另一门学科了<ul>
<li>学习更多渲染和图形学方面的内容，比如光照、阴影</li>
<li>学习渲染引擎方面的开发，可以学学游戏的</li>
</ul>
</li>
</ul>
<p>掌握了技能点之后如何进阶？</p>
<ul>
<li>系统设计与框架搭建能力</li>
<li>站在业务角度发展与进步</li>
</ul>
</li>
<li><p>Android 音视频入门项目</p>
<ul>
<li><a href="https://github.com/cats-oss/android-gpuimage" target="_blank" rel="noopener">Android-gpuimage</a>：偏向渲染，掌握OpenGL渲染链和Shader的写法</li>
<li><a href="https://github.com/saki4510t/AudioVideoRecordingSample" target="_blank" rel="noopener">AudioVideoRecordingSample</a>：偏向录制，实现Android上的音频和视频录制</li>
<li><a href="https://github.com/google/grafika" target="_blank" rel="noopener">google/grafika</a>：综合运用，OpenGL和视频录制等多个样例</li>
</ul>
</li>
<li><p>转行与内推</p>
<ul>
<li><p>音视频学习与转行是两码事</p>
<p>XX有风险，入市需谨慎</p>
</li>
<li><p>项目经历</p>
<p>没有工作经历，要有开源项目，要体现出能力</p>
</li>
<li><p>市场风向</p>
<p>组建技术团队之时，对市场要有敏感度</p>
</li>
</ul>
</li>
<li><p>音视频的上层业务基本是对接SDK，专业的是底层技术</p>
</li>
<li><p>搜商：搜索能力</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/移动Web-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WarriorYu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WarriorYu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/移动Web-1/" itemprop="url">移动Web(1)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T11:30:59+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/大前端/" itemprop="url" rel="index">
                    <span itemprop="name">大前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li><a href="#1-概念">1. 概念</a></li>
<li><a href="#2-适配要求">2. 适配要求</a></li>
<li><a href="#3-适配设置">3. 适配设置</a></li>
<li><a href="#4-viewport的功能">4 . viewport的功能</a></li>
<li><a href="#5-非主流的适配方案">5. 非主流的适配方案：</a></li>
<li><a href="#6-不建议在移动端使用jquery">6. 不建议在移动端使用jquery</a></li>
<li><a href="#7-box-sizing">7. box-sizing</a></li>
<li><a href="#8-点击高亮">8. 点击高亮</a></li>
<li><a href="#9-防止出现图片下间隙">9. 防止出现图片下间隙</a></li>
<li><a href="#10移动端滑动事件">10.移动端滑动事件：</a></li>
<li><a href="#11click在移动端有300ms的延时">11.click在移动端有300ms的延时：</a></li>
<li><a href="#12区域滚动效果">12.区域滚动效果：</a></li>
<li><a href="#13媒体查询">13.媒体查询</a></li>
<li><a href="#14resetcss-和normalizecss区别">14.reset.css 和normalize.css区别</a></li>
<li><a href="#15响应式布局">15.响应式布局</a></li>
<li><a href="#16自定义字体图标">16.自定义字体图标</a></li>
<li><a href="#17boostrap实现导航条">17.boostrap实现导航条</a></li>
<li><a href="#18模板引擎">18.模板引擎</a></li>
<li><a href="#补充">补充：</a></li>
<li><a href="#注意事项">注意事项：</a></li>
<li><a href="#markdown快捷键">MarkDown快捷键：</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h5><ul>
<li>流式布局：就是百分比布局，非固定像素，内容向两侧填充，理解成流动的布局，称为流式布局</li>
<li>视觉窗口：viewport,是移动端特有。这是一个虚拟的区域，承载网页的。</li>
<li>承载关系：浏览器—-&gt;viewport—-&gt;网页</li>
</ul>
<h5 id="2-适配要求"><a href="#2-适配要求" class="headerlink" title="2. 适配要求"></a>2. 适配要求</h5><ul>
<li>网页宽度必须和浏览器保持一致</li>
<li>默认显示的缩放比例和PC端保持（缩放比例1.0）</li>
<li>不允许用户自行缩放网页</li>
<li>满足这些要求达到了适配，国际上通用的适配方案，标准的移动端适配方案。</li>
</ul>
<h5 id="3-适配设置"><a href="#3-适配设置" class="headerlink" title="3. 适配设置"></a>3. 适配设置</h5><ul>
<li>如果任何设置都没有，默认走的就是viewport的默认设置</li>
<li>去设置新的viewport设置,达到适配要求，<meta name="viewport"> 设置视口的标签 在head里面并且应该紧接着编码设置</li>
</ul>
<h5 id="4-viewport的功能"><a href="#4-viewport的功能" class="headerlink" title="4 . viewport的功能"></a>4 . viewport的功能</h5><ul>
<li>width 可以设置宽度 (device-width 当前设备的宽度)</li>
<li>height 可以设置高度</li>
<li>initial-scale 可以设置默认的缩放比例</li>
<li>user-scalable 可以设置是否允许用户自行缩放</li>
<li>maximum-scale 可以设置最大缩放比例</li>
<li>minimum-scale 可以设置最小缩放比例<ul>
<li>在<meta name="viewport" content=""> content=”” 使用以上参数<ol>
<li>width=device-width 宽度一致比例是1.0</li>
<li>initial-scale=1.0 宽度一致比例是1.0</li>
<li>user-scalable=no 不允许用户自行缩放 （yes，no 1,0）</li>
</ol>
</li>
</ul>
</li>
<li>标准适配方案</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0,user-scalable=0&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>快捷方式：meta:vp + tab</p>
<h5 id="5-非主流的适配方案："><a href="#5-非主流的适配方案：" class="headerlink" title="5. 非主流的适配方案："></a>5. 非主流的适配方案：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.页面的真实尺寸会比在设备的上尺寸要大几倍</span><br><span class="line">2.假设设备是iphone4 -&gt; 320px -&gt; 网页尺寸 640px</span><br><span class="line">3.缩放操作，有2倍的  有3倍  和屏幕像素比有关系</span><br><span class="line">4.什么是屏幕像素（物理像素，像素点） px(页面的尺寸单位)</span><br><span class="line">5.物理像素 是设备显示屏的最小可视颗粒的大小   以前的手机（直板手机）</span><br><span class="line">6.现在有 高清显示屏  视网膜屏  retina屏</span><br><span class="line">7.显示的效果就提高了更细腻，但是在显示同等质量的图片的时候（模糊效果）</span><br><span class="line"></span><br><span class="line">8.在屏幕像素比（一个px宽的屏幕能放几个物理像素）高的设备  图片（非矢量）显示会模糊</span><br><span class="line">9.提高网页的清晰度  根据屏幕的像素比 来缩放网页</span><br><span class="line">10.但是这样的适配方案成本非常高</span><br><span class="line">11.一般的企业开发当中使用的还是标准化设置</span><br><span class="line"></span><br><span class="line">在高清显示屏当中：图片可能会失真（模糊）</span><br></pre></td></tr></table></figure>
<h5 id="6-不建议在移动端使用jquery"><a href="#6-不建议在移动端使用jquery" class="headerlink" title="6. 不建议在移动端使用jquery"></a>6. 不建议在移动端使用jquery</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.可以使用jquery,但是不建议</span><br><span class="line">2.jquery  做了很多桌面浏览器的兼容问题 特别是IE，但是移动端没有IE浏览器</span><br><span class="line">3.主流的浏览器：谷歌 火狐（2016年停止了维护和更新） safari浏览器  百度  360 qq ...</span><br><span class="line">4.特点：内核基本上都是  webkit  或者 blink  兼容  -webkit-</span><br><span class="line">5.使用H5的api 或者说使用一个 叫做： zepto.js 的库（基于高版本浏览器开发）</span><br></pre></td></tr></table></figure>
<h5 id="7-box-sizing"><a href="#7-box-sizing" class="headerlink" title="7. box-sizing"></a>7. box-sizing</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*防止内容溢出  不出现滚动条  提供用户体验*/</span><br><span class="line">box-sizing: border-box;</span><br><span class="line"></span><br><span class="line">1. 移动端以流式布局为主</span><br><span class="line">2. 百分比布局</span><br><span class="line">3. 非固定像素布局</span><br><span class="line">4. 无法准确计算容器的尺寸</span><br></pre></td></tr></table></figure>
<h5 id="8-点击高亮"><a href="#8-点击高亮" class="headerlink" title="8. 点击高亮"></a>8. 点击高亮</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/*轻击 轻触*/</span><br><span class="line">-webkit-tap-highlight-color: red;</span><br></pre></td></tr></table></figure>
<h5 id="9-防止出现图片下间隙"><a href="#9-防止出现图片下间隙" class="headerlink" title="9. 防止出现图片下间隙"></a>9. 防止出现图片下间隙</h5><p> 本质是有文字导致的，比如：agfy, g比a在格式上下沉，这样的文字和图片在一起，就会出现图片下间隙。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    body&#123;</span><br><span class="line">        /*font-size: 0px;*/</span><br><span class="line">    &#125;</span><br><span class="line">    或</span><br><span class="line">    img&#123;</span><br><span class="line">        display: block;</span><br><span class="line">    &#125;</span><br><span class="line">    或</span><br><span class="line">    img&#123;</span><br><span class="line">        vertical-align: middle;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h5 id="10-移动端滑动事件："><a href="#10-移动端滑动事件：" class="headerlink" title="10.移动端滑动事件："></a>10.移动端滑动事件：</h5><p>​    touchstart touchmove touchend</p>
<h5 id="11-click在移动端有300ms的延时："><a href="#11-click在移动端有300ms的延时：" class="headerlink" title="11.click在移动端有300ms的延时："></a>11.click在移动端有300ms的延时：</h5><p>​    避免300ms的方案：</p>
<p> 1.tap事件</p>
<p>​    2.fastclick插件使用</p>
<h5 id="12-区域滚动效果："><a href="#12-区域滚动效果：" class="headerlink" title="12.区域滚动效果："></a>12.区域滚动效果：</h5><p>​    插件 isScroll</p>
<h5 id="13-媒体查询"><a href="#13-媒体查询" class="headerlink" title="13.媒体查询"></a>13.媒体查询</h5><p>​    1、使用媒体查询能针对不同屏幕区间设置不同的布局和样式</p>
<p>​    2、怎么使用媒体查询：关于媒体查询 @media</p>
<p>​    3、语法： @media screen and (max-width: 768px) and (min-width: 320px){属性样式}</p>
<p>​    eg:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@media screen and (max-width: 768px) &#123;</span><br><span class="line">    /*1. 在超小屏设备的时候 768px以下      当前容器的宽度100%     背景蓝色*/</span><br><span class="line">    .container&#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        background: blue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-width: 768px) and (max-width: 992px)&#123;</span><br><span class="line">    /*2. 在小屏设备的时候   768px-992px    当前容器的宽度750px    背景绿色*/</span><br><span class="line">    .container&#123;</span><br><span class="line">        width: 750px;</span><br><span class="line">        background: green;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-width: 992px) and (max-width: 1200px)&#123;</span><br><span class="line">    /*3. 在中屏设备的时候   992px-1200px   当前容器的宽度970px    背景红色*/</span><br><span class="line">    .container&#123;</span><br><span class="line">        width: 970px;</span><br><span class="line">        background: red;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-width: 1200px)&#123;</span><br><span class="line">    /*4. 在大屏设备的时候   1200px以上      当前容器的宽度1170px   背景黄色*/</span><br><span class="line">    .container&#123;</span><br><span class="line">        width: 1170px;</span><br><span class="line">        background: yellow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="14-reset-css-和normalize-css区别"><a href="#14-reset-css-和normalize-css区别" class="headerlink" title="14.reset.css 和normalize.css区别"></a>14.reset.css 和normalize.css区别</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">共同点：都是重置样式库，增强浏览器的表现一致性</span><br><span class="line">不同点：都是增强浏览器的表现一致性，但是normalize不会重置已经一致的元素</span><br></pre></td></tr></table></figure>
<h5 id="15-响应式布局"><a href="#15-响应式布局" class="headerlink" title="15.响应式布局"></a>15.响应式布局</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--响应式布局容器--&gt;</span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;!--栅格系统：其实就是行和列的布局，网格状布局--&gt;</span><br><span class="line">    &lt;!--行：row--&gt;</span><br><span class="line">    &lt;!-- .container容器默认有15px的左右内间距  .row 填充父容器的15px的左右内间距   margin-left,margin-right -15px拉伸 --&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">        &lt;!--列：col-*-*  *不确定（参数） --&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">            col：列样式</span><br><span class="line">            第一个*：屏幕的大小</span><br><span class="line">            大屏设备     lg   大屏设备以上生效包含本身</span><br><span class="line">            中屏设备     md   中屏设备以上生效包含本身</span><br><span class="line">            小屏设备     sm   小屏设备以上生效包含本身</span><br><span class="line">            超小屏设备   xs   超小屏设备以上生效包含本身</span><br><span class="line">            &lt;!--</span><br><span class="line">                响应式容器：</span><br><span class="line">                1. 在超小屏设备的时候 768px以下      当前容器的宽度100%     </span><br><span class="line">                2. 在小屏设备的时候   768px-992px    当前容器的宽度750px   </span><br><span class="line">                3. 在中屏设备的时候   992px-1200px   当前容器的宽度970px    </span><br><span class="line">                4. 在大屏设备的时候   1200px以上      当前容器的宽度1170px </span><br><span class="line">                --&gt;</span><br><span class="line">                </span><br><span class="line">            第二个*：每一行的分等份，默认分成12等份 ，数字代表的是占多少份</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;div class=&quot;col-xs-4&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;col-xs-4&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;col-xs-4&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;	</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">大屏设备    显示</span><br><span class="line">中屏设备    隐藏</span><br><span class="line">小屏设备    显示</span><br><span class="line">超小屏设备  隐藏</span><br><span class="line">visible-lg     大屏显示其他隐藏</span><br><span class="line">visible-md</span><br><span class="line">visible-sm</span><br><span class="line">visible-xs</span><br><span class="line">3.2版本以后  建议使用hidden</span><br><span class="line">hidden-lg</span><br><span class="line">hidden-md</span><br><span class="line">hidden-sm</span><br><span class="line">hidden-xs</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
<h5 id="16-自定义字体图标"><a href="#16-自定义字体图标" class="headerlink" title="16.自定义字体图标"></a>16.自定义字体图标</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/*自定义字体图标*/</span><br><span class="line">/*1.通过@font-face定义自己的字体*/</span><br><span class="line">@font-face &#123;</span><br><span class="line">    /*2.申明自己的字体名称*/</span><br><span class="line">    font-family: &apos;wjs&apos;;</span><br><span class="line">    /*3.引入字体文件（约束某一段字符代码什么图案）*/</span><br><span class="line">    src: url(../fonts/MiFie-Web-Font.svg) format(&apos;svg&apos;),</span><br><span class="line">    url(../fonts/MiFie-Web-Font.eot) format(&apos;embedded-opentype&apos;),</span><br><span class="line">    url(../fonts/MiFie-Web-Font.ttf) format(&apos;truetype&apos;),</span><br><span class="line">    url(../fonts/MiFie-Web-Font.woff) format(&apos;woff&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="17-boostrap实现导航条"><a href="#17-boostrap实现导航条" class="headerlink" title="17.boostrap实现导航条"></a>17.boostrap实现导航条</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--切换按钮--&gt;</span><br><span class="line">           &lt;!--</span><br><span class="line">           类名：collapsed  样式</span><br><span class="line">           属性：</span><br><span class="line">           data-toggle=&quot;collapse&quot;  申明是什么组件=折叠组件</span><br><span class="line">           data-target=&quot;#bs-example-navbar-collapse-1&quot; 控制的目标元素=选择器</span><br><span class="line">           其他：</span><br><span class="line">           aria-expanded=&quot;false&quot;  aria-* 代表提供给屏幕阅读器使用的（盲人阅读器）</span><br><span class="line">           class=&quot;sr-only&quot; screen read only  代表提供给屏幕阅读器使用的（盲人阅读器）</span><br><span class="line">           --&gt;</span><br></pre></td></tr></table></figure>
<h5 id="18-模板引擎"><a href="#18-模板引擎" class="headerlink" title="18.模板引擎"></a>18.模板引擎</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--使用模版引擎--&gt;</span><br><span class="line">&lt;script type=&quot;text/template&quot; id=&quot;pointTemplate&quot;&gt;</span><br><span class="line">    &lt;% for(var i = 0 ; i &lt; list.length ; i ++)&#123; %&gt;</span><br><span class="line">        &lt;li data-target=&quot;#carousel-example-generic&quot; data-slide-to=&quot;&lt;%=i%&gt;&quot; class=&quot;					&lt;%=i==0?&apos;active&apos;:&apos;&apos;%&gt;&quot;&gt;&lt;/li&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/template&quot; id=&quot;imageTemplate&quot;&gt;</span><br><span class="line">    &lt;% for(var i = 0 ; i &lt; list.length ; i ++)&#123; %&gt;</span><br><span class="line">    &lt;div class=&quot;item &lt;%=i==0?&apos;active&apos;:&apos;&apos;%&gt;&quot;&gt;</span><br><span class="line">        &lt;% if(isMobile)&#123; %&gt;</span><br><span class="line">        	&lt;a href=&quot;#&quot; class=&quot;m_imgBox&quot;&gt;&lt;img src=&quot;&lt;%=list[i].mUrl%&gt;&quot; alt=&quot;&quot;&gt;&lt;/a&gt;</span><br><span class="line">        &lt;% &#125;else&#123; %&gt;</span><br><span class="line">        	&lt;a href=&quot;#&quot; class=&quot;pc_imgBox&quot; style=&quot;background-image: </span><br><span class="line">        	    url(&lt;%=list[i].pcUrl%&gt;)&quot;&gt;&lt;/a&gt;</span><br><span class="line">        &lt;% &#125; %&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h5><ol>
<li><p>a.offsetWidth; 获取控件的宽度</p>
</li>
<li><p>document.querySelector(‘.class_name); 获取标签</p>
</li>
<li><p>box.querySelectorAll(‘li’); 获取li标签数组</p>
</li>
<li><p>imageBox.style.transition = ‘all 0.2s’;</p>
<p>imageBox.style.webkitTransition = ‘all 0.2s’; css3属性要做兼容</p>
</li>
<li><p>浮动的元素因为脱离标准文档流没有高度，当设置touch事件的时候会无法响应事件，所以要清除浮动。</p>
</li>
<li><p>dom.addEventListener(‘touchmove’,function(e){</p>
<p>​    var moveX = e.touches[0].clientX;</p>
<p>})</p>
</li>
<li><p>实现两栏，左侧一栏设定：width：100px，float:left ; 右侧一栏设置overflow:hidden。可实现右侧占满屏幕，从而实现两栏。</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1、css代码</span><br><span class="line">/*  +,~选择器   + 紧邻的下一个兄弟元素  ~ 后面所有的兄弟元素*/</span><br><span class="line">.wjs_topBar &gt; .container &gt; .row &gt; div &#123;</span><br><span class="line">    height: 40px;</span><br><span class="line">    line-height: 40px;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.wjs_topBar &gt; .container &gt; .row &gt; div ~ div &#123;</span><br><span class="line">    border-left: 1px solid #ccc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2、html代码</span><br><span class="line">&lt;header class=&quot;wjs_topBar hidden-sm hidden-xs&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;col-md-2&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;col-md-5&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;col-md-2&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;col-md-3&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/header&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h5><ol>
<li>js方法调用一定不能忘记加小括号“()”，因为不会报错，eg: e.prevertDefault();</li>
<li>tranform:translateX(1px);  能提高层级</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/集合概述/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WarriorYu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WarriorYu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/集合概述/" itemprop="url">集合概述</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T11:29:15+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java基础/" itemprop="url" rel="index">
                    <span itemprop="name">Java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1: Collection集合总结(掌握)</p>
<p>​    Collection</p>
<p>​        |–List    有序,可重复</p>
<p>​            |–ArrayList</p>
<p>​                底层数据结构是数组，查询快，增删慢。</p>
<p>​                线程不安全，效率高</p>
<p>​            |–Vector</p>
<p>​                底层数据结构是数组，查询快，增删慢。</p>
<p>​                线程安全，效率低</p>
<p>​            |–LinkedList</p>
<p>​                底层数据结构是链表，查询慢，增删快。</p>
<p>​                线程不安全，效率高</p>
<p>​        |–Set    无序,唯一</p>
<p>​            |–HashSet</p>
<p>​                底层数据结构是哈希表。</p>
<p>​                如何保证元素唯一性的呢?</p>
<p>​                    依赖两个方法：hashCode()和equals()</p>
<p>​                    开发中自动生成这两个方法即可</p>
<p>​                |–LinkedHashSet</p>
<p>​                    底层数据结构是链表和哈希表</p>
<p>​                    由链表保证元素有序</p>
<p>​                    由哈希表保证元素唯一</p>
<p>​            |–TreeSet</p>
<p>​                底层数据结构是红黑树。</p>
<p>​                如何保证元素排序的呢?</p>
<p>​                    自然排序</p>
<p>​                    比较器排序</p>
<p>​                如何保证元素唯一性的呢?</p>
<p>​                    根据比较的返回值是否是0来决定</p>
<p>2：Set集合(理解)</p>
<p>​    (1)Set集合的特点</p>
<p>​        无序,唯一</p>
<p>​    (2)HashSet集合(掌握)</p>
<p>​        A:底层数据结构是哈希表(是一个元素为链表的数组)</p>
<p>​        B:哈希表底层依赖两个方法：hashCode()和equals()</p>
<p>​          执行顺序：</p>
<p>​            首先比较哈希值是否相同</p>
<p>​                相同：继续执行equals()方法</p>
<p>​                    返回true：元素重复了，不添加</p>
<p>​                    返回false：直接把元素添加到集合</p>
<p>​                不同：就直接把元素添加到集合</p>
<p>​        C:如何保证元素唯一性的呢?</p>
<p>​            由hashCode()和equals()保证的</p>
<p>​        D:开发的时候，代码非常的简单，自动生成即可。</p>
<p>​        E:HashSet存储字符串并遍历</p>
<p>​        F:HashSet存储自定义对象并遍历(对象的成员变量值相同即为同一个元素)</p>
<p>​    (3)TreeSet集合</p>
<p>​        A:底层数据结构是红黑树(是一个自平衡的二叉树)</p>
<p>​        B:保证元素的排序方式</p>
<p>​            a:自然排序(元素具备比较性)</p>
<p>​                让元素所属的类实现Comparable接口</p>
<p>​            b:比较器排序(集合具备比较性)</p>
<p>​                让集合构造方法接收Comparator的实现类对象</p>
<p>​        C:把我们讲过的代码看一遍即可</p>
<p>​    (4)案例：</p>
<p>​        A:获取无重复的随机数</p>
<p>​        B:键盘录入学生按照总分从高到底输出</p>
<p>​                            </p>
<p>3: 针对Collection集合我们到底使用谁呢?(掌握)</p>
<p>​    唯一吗?</p>
<p>​        是：Set</p>
<p>​            排序吗?</p>
<p>​                是：TreeSet</p>
<p>​                否：HashSet</p>
<p>​        如果你知道是Set，但是不知道是哪个Set，就用HashSet。</p>
<p>​            </p>
<p>​        否：List</p>
<p>​            要安全吗?</p>
<p>​                是：Vector</p>
<p>​                否：ArrayList或者LinkedList</p>
<p>​                    查询多：ArrayList</p>
<p>​                    增删多：LinkedList</p>
<p>​        如果你知道是List，但是不知道是哪个List，就用ArrayList。</p>
<p>​    </p>
<p>​    如果你知道是Collection集合，但是不知道使用谁，就用ArrayList。</p>
<p>​    </p>
<p>​    如果你知道用集合，就用ArrayList。</p>
<p>​    </p>
<p>4: 在集合中常见的数据结构(掌握)</p>
<p>​    ArrayXxx:底层数据结构是数组，查询快，增删慢</p>
<p>​    LinkedXxx:底层数据结构是链表，查询慢，增删快</p>
<p>​    HashXxx:底层数据结构是哈希表。依赖两个方法：hashCode()和equals()</p>
<p>​    TreeXxx:底层数据结构是二叉树。两种方式排序：自然排序和比较器排序</p>
<p>​        </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/HashMap-Java-1-7分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WarriorYu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WarriorYu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/HashMap-Java-1-7分析/" itemprop="url">HashMap-Java 1.7分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T11:27:35+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java基础/" itemprop="url" rel="index">
                    <span itemprop="name">Java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="HashMap-Java-1-7-解析"><a href="#HashMap-Java-1-7-解析" class="headerlink" title="HashMap Java 1.7 解析"></a>HashMap Java 1.7 解析</h1><ol>
<li><p>定义：基于哈希表的Map接口实现类。</p>
<p>继承了AbstractMap抽象类，实现了Map接口，实现了Cloneable接口，实现了Serializable接口。</p>
</li>
<li><p>不保证有序（如插入顺序）</p>
</li>
<li><p>初始容量是16，最大容量是2^30</p>
</li>
<li><p>允许 null 的键/值。key=null时，放在数组第0个位置，hash值为0。</p>
<p>对比HashTable，由于HashTable对key直接hashCode（），若key为null时，会抛出异常，所以HashTable的key不可为null。</p>
</li>
<li><p>非线程安全（非同步）。可通过 Collections.synchronizedMap(new HashMap())获得线程安全的HashMap.</p>
</li>
<li><p>在第一次put()时会初始化数组。</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * 函数源码分析2：indexFor(hash, table.length)</span><br><span class="line">     * JDK 1.8中实际上无该函数，但原理相同，即具备类似作用的函数</span><br><span class="line">     */</span><br><span class="line">      static int indexFor(int h, int length) &#123;  </span><br><span class="line">          return h &amp; (length-1); </span><br><span class="line">          // 将对哈希码扰动处理后的结果 与运算(&amp;) （数组长度-1），最终得到存储在数组table的位置（即数组下标、索引）</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p><strong>问题1：</strong> 为什么不直接采用经过hashCode（）处理的哈希码 作为 存储数组table的下标位置？</p>
<p>为了解决 “哈希码与数组大小范围不匹配” 的问题，<code>HashMap</code>给出了解决方案：<strong>哈希码 与运算（&amp;） （数组长度-1）</strong>；</p>
</li>
<li><p><strong>问题2：</strong> 为什么采用 哈希码 与运算(&amp;) （数组长度-1） 计算数组下标？</p>
<p>首先，数组长度是2的次幂，二进制表示就是首位为1，其他位都为0，如果直接和hash码做&amp;运算的话，得到的数组索引结果都是偶数，相当于浪费了一般的数组空间。如果（数组长度-1）首位为1，低位为1，和hash码做&amp;运算的结果有哈希码决定，可能为1或0，这样保证了计算后的数组存储位置的均匀性，降低了hash冲突。</p>
<p>其次，h &amp; (length-1)相当于h % length，即hash值对数组长度取模。之所以与(&amp;)运算，而非求余(%)，是为了提高运算效率。</p>
</li>
<li><p><strong>问题3</strong>：为什么在计算数组下标前，需对哈希码进行二次处理：扰动处理？</p>
<p>增大哈希码低位的随机性，使得分布更均匀，从而提高对应数组存储下标位置的随机性 &amp; 均匀性，最终减少Hash冲突。</p>
</li>
<li><h3 id="为什么-HashMap-中-String、Integer-这样的包装类适合作为-key-键"><a href="#为什么-HashMap-中-String、Integer-这样的包装类适合作为-key-键" class="headerlink" title="为什么 HashMap 中 String、Integer 这样的包装类适合作为 key 键"></a>为什么 HashMap 中 String、Integer 这样的包装类适合作为 key 键</h3><ul>
<li>final类型，保证了key的不可变性。</li>
<li>内部已重写了hashCode() 、equals()方法。</li>
</ul>
</li>
<li><p>HashMap 中的 key若 Object类型， 则需实现哪些方法？</p>
<p>实现 hashCode() 、equals()。</p>
<ul>
<li>hashCode()：计算需存储数据的存储位置。实现不恰当会导致严重的hash冲突。</li>
<li>equals()：比较存储位置上是否存在存储数据的键 Key，保证键 Key 在哈希表中的唯一性。存在，则更新value值即可。不存在，则直接插入数据。</li>
</ul>
</li>
</ul>
<ol>
<li>插入前，先判断容量是否足够，若不足够，则进行扩容（2倍）、重新计算Hash值、重新计算存储数组下标。</li>
<li>若旧容量已经是系统默认最大容量了，那么将阈值设置成整型的最大值。</li>
<li>扩容时，根据新容量（2倍容量）新建1个数组，即新table 。将旧数组上的数据（键值对）转移到新table中，从而完成扩容 。然后 重新设置阈值 threshold = (int)(newCapacity * loadFactor);</li>
<li>键值对的添加方式：单链表的头插法<ul>
<li>即 将该位置（数组上）原来的数据放在该位置的（链表）下1个节点中（next）、在该位置（数组上）放入需插入的数据-&gt; 从而形成链表。</li>
<li>在扩容<code>resize（）</code>过程中，在将旧数组上的数据 转移到 新数组上时，转移操作 = 按旧链表的正序遍历链表、在新链表的头部依次插入，即在转移数据、扩容后，容易出现<strong>链表逆序</strong>的情况。</li>
<li>此时若（多线程）并发执行 put（）操作，一旦出现扩容情况，则 <strong>容易出现 环形链表</strong>，从而在获取数据、遍历链表时 形成死循环（Infinite Loop），即 死锁的状态 = <strong>线程不安全</strong> 。</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意：由于 `JDK 1.8` 转移数据操作 = **按旧链表的正序遍历链表、在新链表的尾部依次插入** ，所以不会出现链表 **逆序、倒置** 的情况，故不容易出现环形链表的情况。</span><br><span class="line"></span><br><span class="line">但 `JDK 1.8` 还是线程不安全，因为 无加同步锁保护</span><br></pre></td></tr></table></figure>
<ol>
<li>核心参数：<ul>
<li>数组（Table）的大小 =容量的大小（capacity）。默认容量是16。容量范围必须是2的次幂 &amp; &lt; 最大容量（2^30)。</li>
<li>加载因子（loadFactor） = 0.75。</li>
<li>扩容阈值（threshold） = 容量（capacity） * 加载因子（loadFactor）</li>
<li>HashMap 大小 = 数组长度 + 所有链表的长度。</li>
</ul>
</li>
</ol>
<blockquote>
<p>参考：<a href="https://www.jianshu.com/p/e5c8a814c0ca" target="_blank" rel="noopener">Java：这是一份全面 &amp; 详细的HashMap 1.7源码分析指南</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/Java-并发核心知识体系/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WarriorYu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WarriorYu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/Java-并发核心知识体系/" itemprop="url">Java 并发核心知识体系</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T11:08:13+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java基础/" itemprop="url" rel="index">
                    <span itemprop="name">Java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <strong>笔记</strong></p>
<p><strong>Java 并发核心知识体系精讲</strong></p>
<p><strong>一. 线程八大核心</strong></p>
<p><strong>第3章：实现线程的方式：</strong> </p>
<p><img src="/images/thread1.png" alt="Introduction"></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread1.png" alt="thread1" style="zoom:33%;"></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread2.png" alt="thread1" style="zoom:33%;"></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread3.png" alt="thread1" style="zoom:33%;"></p>
<p><strong>第4章：线程启动</strong></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread4.png" alt="thread1" style="zoom:33%;"></p>
<p><strong>直接调用run()是在主线程或者当前子线程执行。而start()方法，先检查线程的状态，通过native方法start0()再启动新线程。</strong></p>
<p><strong>第5章：如何正确停止线程</strong></p>
<p><strong>1. 原理介绍：使用interrupt来通知，而不是强制。</strong></p>
<p><strong>2.</strong></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread5.png" alt="thread1" style="zoom:33%;"></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread6.png" alt="thread1" style="zoom:33%;"></p>
<p><strong>3.</strong></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread7.png" alt="thread1" style="zoom:33%;"></p>
<p><strong>4.</strong></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread8.png" alt="thread1" style="zoom:33%;"></p>
<p><strong>5.</strong> </p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread9.png" alt="thread1" style="zoom:33%;"></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread10.png" alt="thread1" style="zoom:33%;"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create   : 2020/7/31</span></span><br><span class="line"><span class="comment"> * Describe : 注意Thread.interrupted()方法的目标对象是"当前线程"，而不管本方法来自于哪个对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RightWayInterrupted</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread threadOne = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        threadOne.start();</span><br><span class="line">        threadOne.interrupt();</span><br><span class="line">        <span class="comment">// 获取中断标志</span></span><br><span class="line">        System.out.println(<span class="string">"isInterrupted:"</span> + threadOne.isInterrupted());</span><br><span class="line">        <span class="comment">// 获取中断标志并重置</span></span><br><span class="line">        <span class="comment">// 因为interrupted()是静态方法，不管是threadOne还是Thread，</span></span><br><span class="line">        <span class="comment">// 执行它的都是主函数main函数，main函数没有经过任何的中断，所以返回false。</span></span><br><span class="line">        System.out.println(<span class="string">"isInterrupted:"</span> + threadOne.interrupted());</span><br><span class="line">        <span class="comment">// 获取中断标志并重置 原理同上</span></span><br><span class="line">        System.out.println(<span class="string">"isInterrupted:"</span> + Thread.interrupted());</span><br><span class="line">        <span class="comment">// 获取中断标志</span></span><br><span class="line">        System.out.println(<span class="string">"isInterrupted:"</span> + threadOne.isInterrupted());</span><br><span class="line">        threadOne.join();</span><br><span class="line">        System.out.println(<span class="string">"Main thread is over"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 打印结果：</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * isInterrupted:true</span></span><br><span class="line"><span class="comment">         * isInterrupted:false</span></span><br><span class="line"><span class="comment">         * isInterrupted:false</span></span><br><span class="line"><span class="comment">         * isInterrupted:true</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>6.线程的 6个状态（生命周期）</strong></p>
<ol>
<li>Java线程的6种状态及切换(透彻讲解)：<a href="https://blog.csdn.net/pange1991/article/details/53860651" target="_blank" rel="noopener">https://blog.csdn.net/pange1991/article/details/53860651</a></li>
</ol>
<p>2.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread11.png" alt="thread1" style="zoom:20%;"></p>
<p>3.</p>
<ol>
<li><p><strong>初始(NEW)</strong>：新创建了一个线程对象，但还没有调用start()方法。</p>
</li>
<li><p><strong>运行(RUNNABLE)</strong>：Java线程中将就绪（ready）和运行中（running）两种状态笼统的称为“运行”。</p>
</li>
</ol>
<p>线程对象创建后，其他线程(比如main线程）调用了该对象的start()方法。该状态的线程位于可运行线程池中，等待被线程调度选中，获取CPU的使用权，此时处于就绪状态（ready）。就绪状态的线程在获得CPU时间片后变为运行中状态（running）。</p>
<ol start="3">
<li><p><strong>阻塞(BLOCKED)</strong>：表示线程阻塞于锁。一定是Synchronized修饰的代码块或者方法才有这个状态。</p>
</li>
<li><p><strong>等待(WAITING)</strong>：进入该状态的线程需要等待其他线程做出一些特定动作（通知或中断）。</p>
</li>
<li><p><strong>超时等待(TIMED_WAITING)</strong>：该状态不同于WAITING，它可以在指定的时间后自行返回。</p>
</li>
<li><p><strong>终止(TERMINATED)</strong>：表示该线程已经执行完毕。</p>
</li>
</ol>
<p>4.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread12.png" alt="thread1" style="zoom:33%;"></p>
<p>5.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread13.png" alt="thread1" style="zoom:33%;"></p>
<p>6.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread14.png" alt="thread1" style="zoom:33%;"></p>
<p>根据上面第4点的图解答即可。</p>
<p><strong>第7章 核心5：趣解Thread和Object类中线程相关方法</strong></p>
<p>1.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread15.png" alt="thread1" style="zoom:25%;"></p>
<p>2.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread16.png" alt="thread1" style="zoom:25%;"></p>
<p>3.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread17.png" alt="thread1" style="zoom:25%;"></p>
<p>4.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread18.png" alt="thread1" style="zoom:25%;"></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread19.png" alt="thread1" style="zoom:25%;"></p>
<p>5.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread20.png" alt="thread1" style="zoom:25%;"></p>
<p>6.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread21.png" alt="thread1" style="zoom:25%;"></p>
<p>7.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread22.png" alt="thread1" style="zoom:25%;"></p>
<p>8.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread23.png" alt="thread1" style="zoom:25%;"></p>
<p>9.</p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread24.png" alt="thread1" style="zoom:25%;"></p>
<p><strong>第8章 核心6：一网打尽线程属性</strong></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread25.png" alt="thread1" style="zoom:25%;"></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread26.png" alt="thread1" style="zoom:25%;"></p>
<p><strong>第10章 核心8：追寻并发的崇高理想-线程安全</strong></p>
<p><img src="/Users/yuxibing/Work_codes/MyBlog/WarriorYu.github.io/source/images/thread27.png" alt="thread1" style="zoom:25%;"></p>
<blockquote>
<p><strong>本文配套用于慕课网悟空老师的《Java并发核心知识精讲》课，本文所涵盖的知识导图的内容，在课程中有详细讲解。</strong></p>
<p><strong>课程地址：</strong><a href="https://coding.imooc.com/class/362.html" target="_blank" rel="noopener"><strong>https://coding.imooc.com/class/362.html</strong></a></p>
<p><strong>以下思维导图会持续更新，所以请访问线上版本：</strong></p>
<p><strong>线程8大核心基础：</strong></p>
<p><a href="http://naotu.baidu.com/file/07f437ff6bc3fa7939e171b00f133e17?token=6744a1c6ca6860a0" target="_blank" rel="noopener"><strong>http://naotu.baidu.com/file/07f437ff6bc3fa7939e171b00f133e17?token=6744a1c6ca6860a0</strong></a></p>
<p><strong>Java内存模型——底层原理：</strong></p>
<p><a href="http://naotu.baidu.com/file/60a0bdcaca7c6b92fcc5f796fe6f6bc9?token=bcdbae34bb3b0533" target="_blank" rel="noopener"><strong>http://naotu.baidu.com/file/60a0bdcaca7c6b92fcc5f796fe6f6bc9?token=bcdbae34bb3b0533</strong></a></p>
<p><strong>死锁——从产生到消除：</strong></p>
<p><a href="http://naotu.baidu.com/file/ec7748c253f4fc9d88ac1cc1e47814f3?token=bb71b5895a747d67" target="_blank" rel="noopener"><strong>http://naotu.baidu.com/file/ec7748c253f4fc9d88ac1cc1e47814f3?token=bb71b5895a747d67</strong></a></p>
<p><strong>二级大纲（复习用） 成体系的Java并发多线程核心+内存模型+死锁——从用法到原理，面试必考：</strong></p>
<p><a href="http://naotu.baidu.com/file/29942292cd032adfae23c09783676004?token=130df3d389cab703" target="_blank" rel="noopener"><strong>http://naotu.baidu.com/file/29942292cd032adfae23c09783676004?token=130df3d389cab703</strong></a></p>
<p><strong>并发工具类分类：</strong></p>
<p><a href="http://naotu.baidu.com/file/3902a010470d7c1cf76fe719be124797?token=bec25304cc071bf1" target="_blank" rel="noopener"><strong>http://naotu.baidu.com/file/3902a010470d7c1cf76fe719be124797?token=bec25304cc071bf1</strong></a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/动画分类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WarriorYu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WarriorYu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/动画分类/" itemprop="url">动画分类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T10:57:57+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/动画/" itemprop="url" rel="index">
                    <span itemprop="name">动画</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>动画总结:</p>
<ol>
<li><p>补间动画:指的是TranslationAnimation，AlpahAnimation,ScaleAnimation,RotateAnimation； 缺点：并没有真正持久改变View的属性，就是说它内部没有一个去记录动画行为的机制;  </p>
</li>
<li><p>帧动画：指的是一帧一帧播放的动画 实现：通过animation-list来实现，写法如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;animation-list xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span> &gt; </span><br><span class="line">   	&lt;item android:duration=<span class="string">"200"</span> android:drawable=<span class="string">"@drawable/ic_launcher"</span>/&gt;  </span><br><span class="line">    &lt;item android:duration=<span class="string">"200"</span> android:drawable=<span class="string">"@drawable/ic_launcher"</span>/&gt;  </span><br><span class="line">    &lt;item android:duration=<span class="string">"200"</span> android:drawable=<span class="string">"@drawable/ic_launcher"</span>/&gt; </span><br><span class="line">&lt;/animation-list&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="3">
<li><p>属性动画(为了解决补间动画的缺点) </p>
<ol>
<li><p>属性动画内部实现：3.0之后view类增加新的用来记录动画行为的属性，如：</p>
<ul>
<li>translationX，translationY;         </li>
<li>scaleX,scaleY;         </li>
<li>rotationX,rotationY,rotation;         </li>
<li>alpha;          </li>
</ul>
<p>具体实现的类：ObjectAnimator; </p>
<p>问题是：ObjectAnimator只能是3.0之后才有，那么我们如果想让属性动画兼容低版本，那么一般     使用NineOldAnidroid.jar来实现属性动画 </p>
</li>
<li><p>NineOldAnidroid.jar:主要封装了属性动画和View相关的操作类，该类库是JackWharton来写的；</p>
<p> 用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ViewPropertyAnimator.animate(text)</span><br><span class="line">  .rotationBy(<span class="number">180</span>)</span><br><span class="line">  .setDuration(<span class="number">500</span>)</span><br><span class="line">  .start();</span><br></pre></td></tr></table></figure>
</li>
<li><p>直接操作view的属性来更改view的形态：</p>
<ul>
<li>view.setTranslationX(); </li>
<li>view.setRotationX(); </li>
<li>view.setAlpha(); </li>
<li>view.setScaleX(); </li>
</ul>
<p>//如果想在低版本直接操作view的属性，则用如下方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ViewHelper.setScaleX(text, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>改变动画的运动轨迹：速度插值器</p>
<ul>
<li>OvershootInterpolator:超过一点再回来</li>
<li>BounceInterpolator：像球落地一样的感觉 </li>
</ul>
</li>
<li><p>自定义动画逻辑：ValueAnimator（值动画）</p>
<p>ValueAnimator: 它只是帮我们定义了动画的执行流程，但是没有帮我们实行具体的动画逻辑，我们需要监听动画的进度，然后在回调方法中进行自定义的动画逻辑; 用法：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ValueAnimator animator = ValueAnimator.ofInt(<span class="number">100</span>,<span class="number">1000</span>); </span><br><span class="line"><span class="comment">//监听动画执行的进度 	</span></span><br><span class="line">animator.addUpdateListener(<span class="keyword">new</span> AnimatorUpdateListener() &#123; </span><br><span class="line">  <span class="meta">@Override</span> 	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animator)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">int</span> animatedValue = (Integer) animator.getAnimatedValue(); </span><br><span class="line">    <span class="comment">//Log.e("tag", "animatorValue:"+animatedValue); 		</span></span><br><span class="line">    <span class="comment">//根据动画值的变化进行我们的动画逻辑 //				</span></span><br><span class="line">    LayoutParams params = text.getLayoutParams();</span><br><span class="line">    <span class="comment">//params.height = animatedValue;</span></span><br><span class="line">    <span class="comment">//text.setLayoutParams(params); 	</span></span><br><span class="line">    text.setText(animatedValue+<span class="string">""</span>); </span><br><span class="line">  &#125; 	</span><br><span class="line">&#125;); 	</span><br><span class="line">animator.setDuration(<span class="number">1500</span>); </span><br><span class="line">animator.setStartDelay(<span class="number">1000</span>); 	</span><br><span class="line">animator.start();</span><br></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/（二）-架构师晋级/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WarriorYu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WarriorYu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/（二）-架构师晋级/" itemprop="url">（二） 架构师晋级</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T10:55:38+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/架构/" itemprop="url" rel="index">
                    <span itemprop="name">架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="2-架构师晋级"><a href="#2-架构师晋级" class="headerlink" title="2. 架构师晋级"></a>2. 架构师晋级</h1><h3 id="一-换肤核心技术"><a href="#一-换肤核心技术" class="headerlink" title="一. 换肤核心技术"></a>一. 换肤核心技术</h3><h4 id="1-首先分析View的创建流程"><a href="#1-首先分析View的创建流程" class="headerlink" title="1. 首先分析View的创建流程"></a>1. 首先分析View的创建流程</h4><p>   即分析AppCompatActivity的setContentView(R.layout.activity_main);    </p>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">           <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">         	<span class="comment">//1.</span></span><br><span class="line">           setContentView(R.layout.activity_main);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppCompatActivity</span> <span class="keyword">extends</span> <span class="title">FragmentActivity</span> <span class="keyword">implements</span> <span class="title">AppCompatCallback</span>,</span></span><br><span class="line"><span class="class">        <span class="title">TaskStackBuilder</span>.<span class="title">SupportParentable</span>, <span class="title">ActionBarDrawerToggle</span>.<span class="title">DelegateProvider</span> </span>&#123;</span><br><span class="line">          </span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentView</span><span class="params">(@LayoutRes <span class="keyword">int</span> layoutResID)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//2.</span></span><br><span class="line">      getDelegate().setContentView(layoutResID);</span><br><span class="line">  &#125;                 </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AppCompatDelegate</span> </span>&#123;</span><br><span class="line">  <span class="comment">//3.</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setContentView</span><span class="params">(@LayoutRes <span class="keyword">int</span> resId)</span></span>;</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppCompatDelegateImpl</span> <span class="keyword">extends</span> <span class="title">AppCompatDelegate</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">MenuBuilder</span>.<span class="title">Callback</span>, <span class="title">LayoutInflater</span>.<span class="title">Factory2</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//4. setContentViews是在这里实现的</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentView</span><span class="params">(<span class="keyword">int</span> resId)</span> </span>&#123;</span><br><span class="line">      ensureSubDecor();</span><br><span class="line">      ViewGroup contentParent = mSubDecor.findViewById(android.R.id.content);</span><br><span class="line">      contentParent.removeAllViews();</span><br><span class="line">      <span class="comment">//我们看这个inflate方法，看是怎么填充view的</span></span><br><span class="line">      LayoutInflater.from(mContext).inflate(resId, contentParent);</span><br><span class="line">      mAppCompatWindowCallback.getWrapped().onContentChanged();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LayoutInflater</span> </span>&#123;</span><br><span class="line">  <span class="comment">//5. </span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> View <span class="title">inflate</span><span class="params">(@LayoutRes <span class="keyword">int</span> resource, @Nullable ViewGroup root)</span> </span>&#123;</span><br><span class="line">    		<span class="comment">//跟进这个方法</span></span><br><span class="line">        <span class="keyword">return</span> inflate(resource, root, root != <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> View <span class="title">inflate</span><span class="params">(@LayoutRes <span class="keyword">int</span> resource, @Nullable ViewGroup root, <span class="keyword">boolean</span> attachToRoot)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Resources res = getContext().getResources();</span><br><span class="line">        View view = tryInflatePrecompiled(resource, res, root, attachToRoot);</span><br><span class="line">        <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> view;</span><br><span class="line">        &#125;</span><br><span class="line">        XmlResourceParser parser = res.getLayout(resource);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          	<span class="comment">//跟进这个方法</span></span><br><span class="line">            <span class="keyword">return</span> inflate(parser, root, attachToRoot);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            parser.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="function"><span class="keyword">public</span> View <span class="title">inflate</span><span class="params">(XmlPullParser parser, @Nullable ViewGroup root, <span class="keyword">boolean</span> attachToRoot)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mConstructorArgs) &#123;</span><br><span class="line">        <span class="comment">// ... 省略部分代码</span></span><br><span class="line">   			<span class="comment">// Temp is the root view that was found in the xml</span></span><br><span class="line">        <span class="comment">// 跟进这个方法</span></span><br><span class="line">        <span class="keyword">final</span> View temp = createViewFromTag(root, name, inflaterContext, attrs);       </span><br><span class="line">        result = temp;</span><br><span class="line">        <span class="comment">// ... 省略部分代码  </span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line">     </span><br><span class="line">   <span class="meta">@UnsupportedAppUsage</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> View <span class="title">createViewFromTag</span><span class="params">(View parent, String name, Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//6. 马上就能看到是怎么创建view的了 </span></span><br><span class="line">       <span class="keyword">return</span> createViewFromTag(parent, name, context, attrs, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="meta">@UnsupportedAppUsage</span></span><br><span class="line">    <span class="function">View <span class="title">createViewFromTag</span><span class="params">(View parent, String name, Context context, AttributeSet attrs,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">boolean</span> ignoreThemeAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (name.equals(<span class="string">"view"</span>)) &#123;</span><br><span class="line">            name = attrs.getAttributeValue(<span class="keyword">null</span>, <span class="string">"class"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">				<span class="comment">// ... 省略部分代码  </span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//7. 在这里创建view -&gt;看下面的分析8</span></span><br><span class="line">            View view = tryCreateView(parent, name, context, attrs);</span><br><span class="line">						<span class="comment">//9. 如果我们拦截view的创建后，还是为空，则走系统的方法</span></span><br><span class="line">            <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">final</span> Object lastContext = mConstructorArgs[<span class="number">0</span>];</span><br><span class="line">                mConstructorArgs[<span class="number">0</span>] = context;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (-<span class="number">1</span> == name.indexOf(<span class="string">'.'</span>)) &#123;</span><br><span class="line">                        view = onCreateView(context, parent, name, attrs);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                      <span class="comment">//控件名有[.]的则是自定义的控件，走这个方法</span></span><br><span class="line">                        view = createView(context, name, <span class="keyword">null</span>, attrs);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    mConstructorArgs[<span class="number">0</span>] = lastContext;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> view;</span><br><span class="line">        		<span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">  <span class="comment">//8. 分析   </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> View <span class="title">tryCreateView</span><span class="params">(@Nullable View parent, @NonNull String name,   </span></span></span><br><span class="line"><span class="function"><span class="params">				// .... </span></span></span><br><span class="line"><span class="function"><span class="params">        View view;</span></span></span><br><span class="line"><span class="function"><span class="params">        // 如果我们提前做了工作，让mFactory2！=<span class="keyword">null</span>,则调用了mFactory2.onCreateView  </span></span></span><br><span class="line"><span class="function"><span class="params">        //我们在Actitivy中重写onCreateView 则拦截住了系统创建view的过程                       </span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">if</span> (mFactory2 != <span class="keyword">null</span>)</span> </span>&#123;</span><br><span class="line">            view = mFactory2.onCreateView(parent, name, context, attrs);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">            view = mFactory.onCreateView(name, context, attrs);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            view = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">				</span><br><span class="line">        <span class="keyword">if</span> (view == <span class="keyword">null</span> &amp;&amp; mPrivateFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">            view = mPrivateFactory.onCreateView(parent, name, context, attrs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>   综上分析，Activity在setContentView(R.layout.activity_main)的时候，通过mFactory2.onCreateView来创建view，我们在Activity中重写onCreateView拦截系统的方法，来创建自己可以实现换肤的控件，没有拦截的控件还是走系统的方法去创建。</p>
<p>   既然找到了需要拦截的方法，那我们再看在哪里可以拦截这个方法。开始分析源码：</p>
<h4 id="2-源码分析，寻找突破点，即找一个可以换肤的节点。"><a href="#2-源码分析，寻找突破点，即找一个可以换肤的节点。" class="headerlink" title="2. 源码分析，寻找突破点，即找一个可以换肤的节点。"></a>2. 源码分析，寻找突破点，即找一个可以换肤的节点。</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    		<span class="comment">//1. 进入onCreate</span></span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_test);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppCompatActivity</span> <span class="keyword">extends</span> <span class="title">FragmentActivity</span> <span class="keyword">implements</span> <span class="title">AppCompatCallback</span>, </span></span><br><span class="line"><span class="class">																								<span class="title">SupportParentable</span>, <span class="title">DelegateProvider</span> </span>&#123;</span><br><span class="line"> 		</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">      AppCompatDelegate delegate = <span class="keyword">this</span>.getDelegate();</span><br><span class="line">			<span class="comment">//2. 进入installViewFactory</span></span><br><span class="line">      delegate.installViewFactory();</span><br><span class="line">      delegate.onCreate(savedInstanceState);</span><br><span class="line">      <span class="keyword">if</span> (delegate.applyDayNight() &amp;&amp; <span class="keyword">this</span>.mThemeId != <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (VERSION.SDK_INT &gt;= <span class="number">23</span>) &#123;</span><br><span class="line">              <span class="keyword">this</span>.onApplyThemeResource(<span class="keyword">this</span>.getTheme(), <span class="keyword">this</span>.mThemeId, <span class="keyword">false</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">this</span>.setTheme(<span class="keyword">this</span>.mThemeId);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AppCompatDelegate</span> </span>&#123;</span><br><span class="line">     <span class="comment">// If you are using your own Factory or Factory2 then you can omit this call, and 			// instead call createView(android.view.View, String, android.content.Context,</span></span><br><span class="line">     <span class="comment">// android.util.AttributeSet) from your factory to return any compatible widgets.</span></span><br><span class="line">     <span class="comment">// 源码注释：如果你想使用自定义的Factory or Factory2，要避免调用此方法，并且重写factory的			 // createView方法</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//3. installViewFactory是一个抽象方法，进入它的实现类继续查看</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">installViewFactory</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppCompatDelegateImpl</span> <span class="keyword">extends</span> <span class="title">AppCompatDelegate</span> <span class="keyword">implements</span> <span class="title">Callback</span>, <span class="title">Factory2</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">installViewFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      LayoutInflater layoutInflater = LayoutInflater.from(mContext);</span><br><span class="line">    	<span class="comment">// 在这里进行了判null的操作，如果我们自己设置了Factory，就阻止了下面的操作，就可以实现自定义</span></span><br><span class="line">      <span class="keyword">if</span> (layoutInflater.getFactory() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        	<span class="comment">//4. 此类实现了Factory2，因为setFactory2(layoutInflater, this)第二个参数是</span></span><br><span class="line">        	<span class="comment">//this，即把Factory2的实现类传进去，实现类实现了onCreateView方法。</span></span><br><span class="line">          LayoutInflaterCompat.setFactory2(layoutInflater, <span class="keyword">this</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!(layoutInflater.getFactory2() <span class="keyword">instanceof</span> AppCompatDelegateImpl)) &#123;</span><br><span class="line">              Log.i(TAG, <span class="string">"The Activity's LayoutInflater already has a Factory installed"</span></span><br><span class="line">                      + <span class="string">" so we can not install AppCompat's"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * From &#123;<span class="doctag">@link</span> LayoutInflater.Factory2&#125;.</span></span><br><span class="line"><span class="comment">   * 5. 实现Factory2的onCreateView方法，在onCreateView方法又调用了createView方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> View <span class="title">onCreateView</span><span class="params">(View parent, String name, Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> createView(parent, name, context, attrs);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * From &#123;<span class="doctag">@link</span> LayoutInflater.Factory2&#125;.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(String name, Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> onCreateView(<span class="keyword">null</span>, name, context, attrs);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> View <span class="title">createView</span><span class="params">(View parent, <span class="keyword">final</span> String name, @NonNull Context context,</span></span></span><br><span class="line"><span class="function"><span class="params">          @NonNull AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    	<span class="comment">//7. 在这个createView方法里就是做了new AppCompatViewInflater()这个工作</span></span><br><span class="line">    	<span class="comment">//  ... 省略部分代码</span></span><br><span class="line">      mAppCompatViewInflater = <span class="keyword">new</span> AppCompatViewInflater();</span><br><span class="line">    	<span class="comment">//  ... 省略部分代码</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">//8. 最后调用了刚才实例化的AppCompatViewInflater的createView方法</span></span><br><span class="line">      <span class="keyword">return</span> mAppCompatViewInflater.createView(parent, name, context, attrs, 		</span><br><span class="line">                                               inheritContext,</span><br><span class="line">              IS_PRE_LOLLIPOP, </span><br><span class="line">              <span class="keyword">true</span>, </span><br><span class="line">              VectorEnabledTintResources.shouldBeUsed()</span><br><span class="line">      );</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppCompatViewInflater</span> </span>&#123;</span><br><span class="line">  <span class="comment">//9. 第8步调用的这个方法。</span></span><br><span class="line">	<span class="function"><span class="keyword">final</span> View <span class="title">createView</span><span class="params">(View parent, <span class="keyword">final</span> String name, @NonNull Context context,</span></span></span><br><span class="line"><span class="function"><span class="params">            @NonNull AttributeSet attrs, <span class="keyword">boolean</span> inheritContext,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">boolean</span> readAndroidTheme, <span class="keyword">boolean</span> readAppTheme, <span class="keyword">boolean</span> wrapContext)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// ... 省略部分代码</span></span><br><span class="line">        View view = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We need to 'inject' our tint aware Views in place of the standard </span></span><br><span class="line">        <span class="comment">// framework versions</span></span><br><span class="line">        <span class="keyword">switch</span> (name) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"TextView"</span>:</span><br><span class="line">                view = createTextView(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"ImageView"</span>:</span><br><span class="line">                view = createImageView(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"Button"</span>:</span><br><span class="line">                view = createButton(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"EditText"</span>:</span><br><span class="line">                view = createEditText(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"Spinner"</span>:</span><br><span class="line">                view = createSpinner(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"ImageButton"</span>:</span><br><span class="line">                view = createImageButton(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"CheckBox"</span>:</span><br><span class="line">                view = createCheckBox(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"RadioButton"</span>:</span><br><span class="line">                view = createRadioButton(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"CheckedTextView"</span>:</span><br><span class="line">                view = createCheckedTextView(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"AutoCompleteTextView"</span>:</span><br><span class="line">                view = createAutoCompleteTextView(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"MultiAutoCompleteTextView"</span>:</span><br><span class="line">                view = createMultiAutoCompleteTextView(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"RatingBar"</span>:</span><br><span class="line">                view = createRatingBar(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"SeekBar"</span>:</span><br><span class="line">                view = createSeekBar(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"ToggleButton"</span>:</span><br><span class="line">                view = createToggleButton(context, attrs);</span><br><span class="line">                verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:          </span><br><span class="line">                view = createView(context, name, attrs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//... 省略部分代码</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Activity</span> <span class="keyword">extends</span> <span class="title">ContextThemeWrapper</span></span></span><br><span class="line"><span class="class">  			//10. 通过查看<span class="title">Activity</span>的源码，可以知道<span class="title">Activity</span>实现了<span class="title">Factory2</span>接口，所以我们可以直接在</span></span><br><span class="line"><span class="class">  			// 自己新建的<span class="title">MainActivity</span>中直接重写<span class="title">Factory2</span>的<span class="title">onCreateView</span>方法。</span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">LayoutInflater</span>.<span class="title">Factory2</span>,</span></span><br><span class="line"><span class="class">        <span class="title">Window</span>.<span class="title">Callback</span>, <span class="title">KeyEvent</span>.<span class="title">Callback</span>,</span></span><br><span class="line"><span class="class">        <span class="title">OnCreateContextMenuListener</span>, <span class="title">ComponentCallbacks2</span>,</span></span><br><span class="line"><span class="class">        <span class="title">Window</span>.<span class="title">OnWindowDismissedCallback</span>, <span class="title">WindowControllerCallback</span>,</span></span><br><span class="line"><span class="class">        <span class="title">AutofillManager</span>.<span class="title">AutofillClient</span> </span>&#123;</span><br></pre></td></tr></table></figure>
<p>   通过以上分析我们得出结论：</p>
<ul>
<li>Activity在onCreate方法里调用了super.onCreate(savedInstanceState) -&gt; delegate.installViewFactory() -&gt; LayoutInflaterCompat.setFactory2(layoutInflater, this) -&gt; this是Factory2的实现类，实现类实现了onCreateView方法 -&gt;mAppCompatViewInflater.createView() </li>
<li>mAppCompatViewInflater.createView() 在这里面通过name（即控件的标签名）初始化了对应的view。 </li>
<li>我们可以在初始化view的时候做工作，即把控件换成自定义控件，自定义控件加上可以动态换肤的工作。 </li>
<li>所以如果想实现换肤，可以实现mAppCompatViewInflater.createView()方法里的工作，又因为Factory2.onCreateView方法调用了这个方法，那么我们可以通过重写onCreateView()来实现目的，又因为Activity实现了Factory2，所以我们可以直接在自己的Activity中重写onCreateView()方法。</li>
<li>通过查看AppCompatActivity.</li>
</ul>
<h4 id="3-换肤实现"><a href="#3-换肤实现" class="headerlink" title="3. 换肤实现"></a>3. 换肤实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">SkinActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String skinPath;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@RequiresApi</span>(api = Build.VERSION_CODES.LOLLIPOP)</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1. 在这里调用了SkinActivity的onCreate</span></span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ((<span class="string">"皮肤包"</span>).equals(PreferencesUtils.getString(<span class="keyword">this</span>, <span class="string">"当前皮肤"</span>))) &#123;</span><br><span class="line">            skinDynamic(skinPath, R.color.skin_item_color);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            defaultSkin(R.color.colorPrimary);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 换肤按钮（api限制：5.0版本）</span></span><br><span class="line">    <span class="meta">@RequiresApi</span>(api = Build.VERSION_CODES.LOLLIPOP)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">skinDynamic</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 真实项目中：需要先判断当前皮肤，避免重复操作！</span></span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">"皮肤包"</span>).equals(PreferencesUtils.getString(<span class="keyword">this</span>, <span class="string">"currentSkin"</span>))) &#123;</span><br><span class="line">           skinDynamic(skinPath, R.color.skin_item_color);</span><br><span class="line">            PreferencesUtils.putString(<span class="keyword">this</span>, <span class="string">"currentSkin"</span>, <span class="string">"皮肤包"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 默认按钮（api限制：5.0版本）</span></span><br><span class="line">    <span class="meta">@RequiresApi</span>(api = Build.VERSION_CODES.LOLLIPOP)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">skinDefault</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">"default"</span>).equals(PreferencesUtils.getString(<span class="keyword">this</span>, <span class="string">"currentSkin"</span>))) &#123;       </span><br><span class="line">            defaultSkin(R.color.colorPrimary);</span><br><span class="line">            PreferencesUtils.putString(<span class="keyword">this</span>, <span class="string">"currentSkin"</span>, <span class="string">"default"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">openChangeSkin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkinActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CustomAppCompatViewInflater viewInflater;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//2. 在这里setFactory2(layoutInflater, this)方法，可以阻止</span></span><br><span class="line">      	<span class="comment">//AppCompatDelegateImpl.installViewFactory(),从而阻止了installViewFactory到	</span></span><br><span class="line">      	<span class="comment">//AppCompatViewInflater.createView()的工作，即阻止了[源码分析]的4-9步。</span></span><br><span class="line">      	<span class="comment">//从而实现我们自定义控件的逻辑</span></span><br><span class="line">        LayoutInflater layoutInflater = LayoutInflater.from(<span class="keyword">this</span>);</span><br><span class="line">        LayoutInflaterCompat.setFactory2(layoutInflater, <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(View parent, String name, Context context, AttributeSet </span></span></span><br><span class="line"><span class="function"><span class="params">                             attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (openChangeSkin()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (viewInflater == <span class="keyword">null</span>) &#123;</span><br><span class="line">              <span class="comment">//3. 自定义CustomAppCompatViewInflater</span></span><br><span class="line">                viewInflater = <span class="keyword">new</span> CustomAppCompatViewInflater(context);</span><br><span class="line">            &#125;</span><br><span class="line">            viewInflater.setName(name);</span><br><span class="line">            viewInflater.setAttrs(attrs);</span><br><span class="line">      			<span class="comment">//4. 在这个方法里将布局中的控件，更换为自定义的换肤控件，从而实现换肤的功能。</span></span><br><span class="line">            <span class="keyword">return</span> viewInflater.autoMatch();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onCreateView(parent, name, context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequiresApi</span>(api = Build.VERSION_CODES.LOLLIPOP)</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">defaultSkin</span><span class="params">(<span class="keyword">int</span> themeColorId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.skinDynamic(<span class="keyword">null</span>, themeColorId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态换肤（api限制：5.0版本）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequiresApi</span>(api = Build.VERSION_CODES.LOLLIPOP)</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">skinDynamic</span><span class="params">(String skinPath, <span class="keyword">int</span> themeColorId)</span> </span>&#123;</span><br><span class="line">        SkinManager.getInstance().loaderSkinResources(skinPath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (themeColorId != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> themeColor = SkinManager.getInstance().getColor(themeColorId);</span><br><span class="line">            StatusBarUtils.forStatusBar(<span class="keyword">this</span>, themeColor);</span><br><span class="line">            NavigationUtils.forNavigation(<span class="keyword">this</span>, themeColor);</span><br><span class="line">            ActionBarUtils.forActionBar(<span class="keyword">this</span>, themeColor);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        applyViews(getWindow().getDecorView());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 控件回调监听，匹配上则给控件执行换肤方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyViews</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewsMatch) &#123;</span><br><span class="line">            ViewsMatch viewsMatch = (ViewsMatch) view;</span><br><span class="line">            viewsMatch.skinnableView();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewGroup) &#123;</span><br><span class="line">            ViewGroup parent = (ViewGroup) view;</span><br><span class="line">            <span class="keyword">int</span> childCount = parent.getChildCount();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) &#123;</span><br><span class="line">                applyViews(parent.getChildAt(i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义控件加载器（可以考虑该类不被继承）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomAppCompatViewInflater</span> <span class="keyword">extends</span> <span class="title">AppCompatViewInflater</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name; <span class="comment">// 控件名</span></span><br><span class="line">    <span class="keyword">private</span> Context context; <span class="comment">// 上下文</span></span><br><span class="line">    <span class="keyword">private</span> AttributeSet attrs; <span class="comment">// 某控件对应所有属性</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomAppCompatViewInflater</span><span class="params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAttrs</span><span class="params">(AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.attrs = attrs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 自动匹配控件名，并初始化控件对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  	<span class="comment">//4. 通过将布局文件里对应name的控件，替换为我们自己的换肤自定义控件，实现换肤操作。</span></span><br><span class="line">		<span class="comment">//注意： 这里有的控件才会实现换肤，没有控件不会实现换肤</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">autoMatch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        View view = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (name) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"LinearLayout"</span>:</span><br><span class="line">                <span class="comment">// view = super.createTextView(context, attrs); // 源码写法</span></span><br><span class="line">                view = <span class="keyword">new</span> SkinnableLinearLayout(context, attrs);</span><br><span class="line">                <span class="keyword">this</span>.verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"RelativeLayout"</span>:</span><br><span class="line">                view = <span class="keyword">new</span> SkinnableRelativeLayout(context, attrs);</span><br><span class="line">                <span class="keyword">this</span>.verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"TextView"</span>:</span><br><span class="line">                view = <span class="keyword">new</span> SkinnableTextView(context, attrs);</span><br><span class="line">                <span class="keyword">this</span>.verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"ImageView"</span>:</span><br><span class="line">                view = <span class="keyword">new</span> SkinnableImageView(context, attrs);</span><br><span class="line">                <span class="keyword">this</span>.verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"Button"</span>:</span><br><span class="line">                view = <span class="keyword">new</span> SkinnableButton(context, attrs);</span><br><span class="line">                <span class="keyword">this</span>.verifyNotNull(view, name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 继承TextView兼容包，9.0源码中也是如此</span></span><br><span class="line"><span class="comment"> * 参考：AppCompatViewInflater.java</span></span><br><span class="line"><span class="comment"> * 86行 + 138行 + 206行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkinnableTextView</span> <span class="keyword">extends</span> <span class="title">AppCompatTextView</span> <span class="keyword">implements</span> <span class="title">ViewsMatch</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AttrsBean attrsBean;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SkinnableTextView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SkinnableTextView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, android.R.attr.textViewStyle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SkinnableTextView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line"></span><br><span class="line">        attrsBean = <span class="keyword">new</span> AttrsBean();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据自定义属性，匹配控件属性的类型集合，如：background + textColor</span></span><br><span class="line">        TypedArray typedArray = context.obtainStyledAttributes(attrs,</span><br><span class="line">                R.styleable.SkinnableTextView,</span><br><span class="line">                defStyleAttr, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 存储到临时JavaBean对象</span></span><br><span class="line">        attrsBean.saveViewResource(typedArray, R.styleable.SkinnableTextView);</span><br><span class="line">        <span class="comment">// 这一句回收非常重要！obtainStyledAttributes()有语法提示！！</span></span><br><span class="line">        typedArray.recycle();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//对Textview进行换肤</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">skinnableView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 根据自定义属性，获取styleable中的background属性</span></span><br><span class="line">        <span class="keyword">int</span> key = R.styleable.SkinnableTextView[R.styleable.SkinnableTextView_android_background];</span><br><span class="line">        <span class="comment">// 根据styleable获取控件某属性的resourceId</span></span><br><span class="line">        <span class="keyword">int</span> backgroundResourceId = attrsBean.getViewResource(key);</span><br><span class="line">        <span class="keyword">if</span> (backgroundResourceId &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 是否默认皮肤</span></span><br><span class="line">            <span class="keyword">if</span> (SkinManager.getInstance().isDefaultSkin()) &#123;</span><br><span class="line">                <span class="comment">// 兼容包转换</span></span><br><span class="line">                Drawable drawable = ContextCompat.getDrawable(getContext(), backgroundResourceId);</span><br><span class="line">                <span class="comment">// 控件自带api，这里不用setBackgroundColor()因为在9.0测试不通过</span></span><br><span class="line">                <span class="comment">// setBackgroundDrawable本来过时了，但是兼容包重写了方法</span></span><br><span class="line">                setBackgroundDrawable(drawable);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 获取皮肤包资源</span></span><br><span class="line">                Object skinResourceId = SkinManager.getInstance().getBackgroundOrSrc(backgroundResourceId);</span><br><span class="line">                <span class="comment">// 兼容包转换</span></span><br><span class="line">                <span class="keyword">if</span> (skinResourceId <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">                    <span class="keyword">int</span> color = (<span class="keyword">int</span>) skinResourceId;</span><br><span class="line">                    setBackgroundColor(color);</span><br><span class="line">                    <span class="comment">// setBackgroundResource(color); // 未做兼容测试</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Drawable drawable = (Drawable) skinResourceId;</span><br><span class="line">                    setBackgroundDrawable(drawable);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据自定义属性，获取styleable中的textColor属性</span></span><br><span class="line">        key = R.styleable.SkinnableTextView[R.styleable.SkinnableTextView_android_textColor];</span><br><span class="line">        <span class="keyword">int</span> textColorResourceId = attrsBean.getViewResource(key);</span><br><span class="line">        <span class="keyword">if</span> (textColorResourceId &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (SkinManager.getInstance().isDefaultSkin()) &#123;</span><br><span class="line">                ColorStateList color = ContextCompat.getColorStateList(getContext(), textColorResourceId);</span><br><span class="line">                setTextColor(color);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ColorStateList color = SkinManager.getInstance().getColorStateList(textColorResourceId);</span><br><span class="line">                setTextColor(color);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据自定义属性，获取styleable中的字体 custom_typeface 属性</span></span><br><span class="line">        key = R.styleable.SkinnableTextView[R.styleable.SkinnableTextView_custom_typeface];</span><br><span class="line">        <span class="keyword">int</span> textTypefaceResourceId = attrsBean.getViewResource(key);</span><br><span class="line">        <span class="keyword">if</span> (textTypefaceResourceId &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (SkinManager.getInstance().isDefaultSkin()) &#123;</span><br><span class="line">                setTypeface(Typeface.DEFAULT);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                setTypeface(SkinManager.getInstance().getTypeface(textTypefaceResourceId));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="二-组件化框架设计"><a href="#二-组件化框架设计" class="headerlink" title="二. 组件化框架设计"></a>二. 组件化框架设计</h3><h4 id="1-APT-Annotation-Processing-Tool"><a href="#1-APT-Annotation-Processing-Tool" class="headerlink" title="1. APT(Annotation Processing Tool)"></a>1. APT(Annotation Processing Tool)</h4><ul>
<li><p>是一种处理注释的工具，它对源代码文件进行检测找出其中的Annotation，根据注解自动生成代码，如果想要自定义的注解处理器能够正常运行，必须通过APT工具来进行处理。</p>
</li>
<li><p>也可以这样理解，只有通过声明APT工具后，程序在编译期间自定义注解解释器才能执行。</p>
</li>
<li><p>通俗理解：根据规则，帮我们生成代码、生成类文件。</p>
</li>
</ul>
<h4 id="2-工具："><a href="#2-工具：" class="headerlink" title="2. 工具："></a>2. 工具：</h4><ol>
<li><a href="https://github.com/square/javapoet" target="_blank" rel="noopener">square/javapoet</a>：JavaPoet 是一个生成.java源文件的Java API.</li>
<li><a href="https://github.com/alibaba/ARouter" target="_blank" rel="noopener">alibaba/ARouter</a>: 帮助 Android App 进行组件化改造的路由框架 .</li>
</ol>
<h4 id="3-组件化里路由的基本思想"><a href="#3-组件化里路由的基本思想" class="headerlink" title="3. 组件化里路由的基本思想"></a>3. 组件化里路由的基本思想</h4><ol>
<li><p>（创建注解）新建Java Library类型的arouter_annotation模块。在里面新建路由注解（ARouter）。</p>
</li>
<li><p>（处理注解）新建Java Library类型的compiler模块。在里面新建继承AbstractProcessor的注解处理类，根据注解获取类的信息，以及注解上的参数等信息，来编写生成源代码的代码。最后在编译时生成源代码文件。</p>
<ul>
<li><p>使用的类库</p>
</li>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// As-3.4.1 + gradle5.1.1-all + auto-service:1.0-rc4</span></span><br><span class="line">compileOnly<span class="string">'com.google.auto.service:auto-service:1.0-rc4'</span></span><br><span class="line">annotationProcessor<span class="string">'com.google.auto.service:auto-service:1.0-rc4'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 帮助我们通过类调用的形式来生成Java代码</span></span><br><span class="line">implementation <span class="string">"com.squareup:javapoet:1.9.0"</span></span><br><span class="line"><span class="comment">// 引入annotation，处理@ARouter注解</span></span><br><span class="line"><span class="function">implementation <span class="title">project</span><span class="params">(<span class="string">':arouter_annotation'</span>)</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>（使用注解）@ARouter(path = “/app/MainActivity”) </p>
</li>
</ol>
<h3 id="三-插件化框架设计"><a href="#三-插件化框架设计" class="headerlink" title="三. 插件化框架设计"></a>三. 插件化框架设计</h3><h4 id="1-原理：可安装运行的宿主APP-gt-可以通过插件化，运行调用下载到本地的没有安装的apk文件。"><a href="#1-原理：可安装运行的宿主APP-gt-可以通过插件化，运行调用下载到本地的没有安装的apk文件。" class="headerlink" title="1. 原理：可安装运行的宿主APP -&gt;可以通过插件化，运行调用下载到本地的没有安装的apk文件。"></a>1. 原理：可安装运行的宿主APP -&gt;可以通过插件化，运行调用下载到本地的没有安装的apk文件。</h4><h4 id="2-占位（插桩）式插件化框架"><a href="#2-占位（插桩）式插件化框架" class="headerlink" title="2. 占位（插桩）式插件化框架"></a>2. 占位（插桩）式插件化框架</h4><ol>
<li><p>基本思想：</p>
<ul>
<li>通过AssetManager获取sd卡中下载好的插件apk，可以获取Resources和DexClassLoader。</li>
<li>新建公共库，定义标准（接口ActivityInterface），比如Activity、service的生命周期方法，以及获取宿主的Context等接口。</li>
<li>作为插件的apk，里面的Activity实现标准接口ActivityInterface。</li>
<li>宿主中新建一个占位(代理)的Activity(ProxyActivity)，并且通过重写相关方法，替换为插件的Resources和DexClassLoader。</li>
<li>当启动插件中的Activity时，先获取插件Activity的ActivityInfo，然后就可以通过反射获取到Activity对象，即ActivityInterface的实现类对象，通过这个对象就可以执行插件里面Activity的方法了。</li>
<li>因为插件中使用的是宿主中的Activity，只需要在宿主中的清单文件中注册代理Activity就行，插件中其实不是真正的Activity，无需注册。</li>
<li>总结为，在宿主中创建一个空的代理Activity，当调用插件中的Activity时，在代理Activity中的方法中调用插件中相同的方法。 </li>
</ul>
</li>
<li><p>Activity、service使用插件的流程差不多，但是BroadcastReceivery有发送和接收两步，所以多了一步接收的操作。</p>
</li>
<li><p>静态注册的广播，是什么时候注册的？</p>
<ul>
<li>手机开机的时候，所有的app，再次进行安装一遍，系统会去解析AndroidManifest，解析静态广播，进行注册。</li>
</ul>
</li>
<li><p>有关插件的问题</p>
<ul>
<li><p>在插件中，为什么不能使用 this<br>答：因为插件是没有安装手机上安装的，是无法拥有组件环境的。</p>
</li>
<li><p>为什么要有代理的Activity<br>答：由于插件中的Activity，并不是一个能够运行的组件，所以需要代理的Activity去代替  插件中的Activity (例如：Activity任务进栈)。</p>
</li>
<li><p>这种插件化，在写插件开发的时候有什么（要注意的事项）<br>答：所有关于操作，组件环境的地方，都必须使用 宿主的环境。 </p>
</li>
</ul>
</li>
<li><p>Apk解析原理系统源码分析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">1.静态注册的广播,是什么时候注册的？</span><br><span class="line">手机开机的时候, 所有的app，再次进行安装一遍, 系统会去解析AndroidManifest，解析静态广播后，就会自动注册</span><br><span class="line"></span><br><span class="line">2.我们去分析 安装</span><br><span class="line">data/app 放置目录</span><br><span class="line">data/data/包名/ 应用所属目录</span><br><span class="line">data/dalvik-cache  虚拟机去加载执行指令</span><br><span class="line"></span><br><span class="line">3.该分析那个目录</span><br><span class="line">data/app 放置目录</span><br><span class="line"></span><br><span class="line">手机开机安装app的时候，安装 过后 马上就会 全盘扫描，data/app 放置目录</span><br><span class="line"></span><br><span class="line">解析出 app apk 文件 里面所有组件，包括权限，系统会去解析AndroidManifest</span><br><span class="line"></span><br><span class="line">Android 会在 安装过后，会马上扫描此目录data/app 放置目录 ---&gt; 解析 apk 文件 里面的配置信息AndroidManifest.xml ,如果里面有静态配置的广播</span><br><span class="line">就会要去注册广播</span><br><span class="line"></span><br><span class="line">分析系统源码，是如何进行解析apk</span><br><span class="line"></span><br><span class="line">PackageManagerService</span><br><span class="line"></span><br><span class="line">【目标】：看系统是如何 去解析 apk 文件里面的 组件信息的</span><br><span class="line">系统是在安装的时候，才会去扫描，apk</span><br><span class="line"></span><br><span class="line">PackageManagerService</span><br><span class="line"></span><br><span class="line">Linux内核驱动  --- init进程  -- zygote进程 孵化  SystemServer --- PackageManagerService启动</span><br><span class="line"></span><br><span class="line">PackageManagerService启动</span><br><span class="line">pms 如何去 处理 data/app/目录 ，如何解析apk</span><br><span class="line"></span><br><span class="line">dataDir /data/目录</span><br><span class="line"></span><br><span class="line">mAppInstallDir = new File(dataDir, &quot;app&quot;); /data/app/目录</span><br><span class="line">mAppInstallDir：如何去解析apk文件的</span><br><span class="line"></span><br><span class="line">scanDirTracedLI 是要去扫描 /data/app/目录下的apk文件  ---&gt; 解析AndroidManifest 里面的所有信息</span><br><span class="line"></span><br><span class="line">扫描 apk 文件，解析apk  scanPackageLI ---&gt;</span><br><span class="line"></span><br><span class="line">parsePackage：解析 apk 文件里面的所有信息</span><br><span class="line"></span><br><span class="line">Package ---&gt;  apk 里面的 AndroidManifest配置信息 （所有的）</span><br><span class="line"></span><br><span class="line">拿到了Package，就能拿到 静态的广播信息</span><br><span class="line"></span><br><span class="line">最终的目标：</span><br><span class="line">&lt;!-- 静态注册的广播 --&gt;</span><br><span class="line">&lt;receiver android:name=&quot;.StaticReceiver&quot;&gt;</span><br><span class="line"></span><br><span class="line">   &lt;intent-filter&gt;</span><br><span class="line"></span><br><span class="line">                &lt;action android:name=&quot;plugin.static_receiver&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/receiver&gt;</span><br></pre></td></tr></table></figure>
<p>总结为：PackageManagerService可以加载手机里的任何apk，从它的构造方法可以看出，安装的apk文件都在data/app目录里，当扫描这个目录里的某个apk文件时,，调用了PackageParser.parsePackage()方法，并且返回Package类，这个类有个字段属性receivers（ArrayList<activity> ），就是AndroidMannifest里的receiver，receivers里面的泛型Activity不是四大组件的Activity，通过这个Activity可以获取跟广播相关的一些信息。所以，我们可以通过反射，根据上面的源码，一步步获取AndroidManifest里有关广播的一些信息，然后在代码中注册广播即可。</activity></p>
</li>
</ol>
<h4 id="3-Hook式插件化框架"><a href="#3-Hook式插件化框架" class="headerlink" title="3. Hook式插件化框架"></a>3. Hook式插件化框架</h4><ol>
<li><p>Hook 基础 – 从入门到熟练</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.替换（把系统里面的 替换成 动态代理）</span><br><span class="line"><span class="number">2</span>.添加动态代理（做我们自己的业务逻辑）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---- Hook 系统源码 ----&gt; TestActivity 不再AndroidManifest里面注册，也能启动</span><br><span class="line">会报错：TestActivity&#125;; have you declared <span class="keyword">this</span> activity in your AndroidManifest.xml?  没有在AndroidManifest里面注册</span><br><span class="line"></span><br><span class="line">原因：</span><br><span class="line"></span><br><span class="line">startActivity ---&gt;  TestActivity ----》 （Hook） （AMS）ActivityManagerService（检测，当前要启动的Activity是否注册了）</span><br><span class="line"></span><br><span class="line">Hook  （Hook）：</span><br><span class="line"><span class="number">1</span>.把TestActivity 替换我们真实有效的Activity</span><br><span class="line"></span><br><span class="line">startActivity(TestActivity) ---&gt; Activity --&gt; Instrumentation.execStartActivity ---&gt; ActivityManagerNative.getDefault()</span><br><span class="line"> IActivityManager.startActivity ---&gt;  (Hook)   AMS.startActivity（检测，当前要启动的Activity是否注册了）</span><br><span class="line"></span><br><span class="line"> 思想切入点：既然会得到IActivityManager，会设置IActivityManager，（寻找替换点(动态代理)）</span><br><span class="line"></span><br><span class="line"> 动态代理：由于执行startActivity之前，我们需要先执行我们的代码(把TestActivity 替换成 已经注册的 Activity)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.ASM检查过后，要把这个ProxyActivity 换回来 --&gt; TestActivity</span><br><span class="line"></span><br><span class="line">startActivity ---&gt;  TestActivity -- （Hook ProxyActivity）（AMS）检测，当前要启动的Activity是否注册了）ok ---》</span><br><span class="line">  ActivityThread（即将加载启动Activity）----(要把这个ProxyActivity 换回来 --&gt; TestActivity)</span><br><span class="line"></span><br><span class="line">Hook LAUNCH_ACTIVITY</span><br><span class="line"></span><br><span class="line">我们要在Handler。handleMessage 之前执行，就是为了(要把这个ProxyActivity 换回来 --&gt; TestActivity)，所有需要Hook</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>.hook ams检查  把TestActivity 换成 ProxyActivity</span><br><span class="line"><span class="number">2</span>.hook 即将要加载Activity又把ProxyActivity 换回来了 TestActivity</span><br></pre></td></tr></table></figure>
</li>
<li><p>类加载  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">学习类加载之前，我们去startActivity跳转 到 插件中的Activity看会发生什么错误（分析错误的过程中学习类加载）</span><br><span class="line"></span><br><span class="line">宿主 跳转 宿主的Actvity       ok</span><br><span class="line"></span><br><span class="line">宿主 跳转 插件里面的Activity  报错</span><br><span class="line">分析错误原因，来学习Android类加载：</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: Didn<span class="string">'t find class "com.netease.plugin_package.PluginActivity" on path:</span></span><br><span class="line"><span class="string"> DexPathList[[zip file "/data/app/com.netease.hookproject-1/base.apk", zip file "/data/app/com.netease.hookproject-1/split_lib_</span></span><br><span class="line"><span class="string"> dependencies_apk.apk", zip file "/data/app/com.netease.hookproject-1/split_lib_slice_0_apk.apk", zip file "/data/app/com</span></span><br><span class="line"><span class="string"> .netease.hookproject-1/split_lib_slice_1_apk.apk", zip file "/data/app/com.netease.hookproject-1/split_lib_slice_2_apk.apk"</span></span><br><span class="line"><span class="string"> , zip file "/data/app/com.netease.hookproject-1/split_lib_slice_3_apk.apk", zip file "/data/app/com.netease.hookproject-1/s</span></span><br><span class="line"><span class="string"> plit_lib_slice_4_apk.apk", zip file "/data/app/com.netease.hookproject-1/split_lib_slice_5_apk.apk", zip file "/data/app/com</span></span><br><span class="line"><span class="string"> .netease.hookproject-1/split_lib_slice_6_apk.apk", zip file "/data/app/com.netease.hookproject-1/split_lib_slice_7_apk.apk",</span></span><br><span class="line"><span class="string"> zip file "/data/app/com.netease.hookproject-1/split_lib_slice_8_apk.apk", zip file "/data/app/com.netease.hookproject-1/spli</span></span><br><span class="line"><span class="string"> t_lib_slice_9_apk.apk"],nativeLibraryDirectories=[/vendor/lib, /system/lib]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> startActivity --&gt; AMS ---&gt; ActivityThread(把代理的Activity给换回来了) ---&gt; 要去实例化Activity （报错）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> Activity --&gt; Instrumentation ---&gt; AMS检查 ---&gt;</span></span><br><span class="line"><span class="string">    ActivityThread (即将加载)-（handleLaunchActivity 类加载Activity performLaunchActivity ---&gt; newActivity(cl == PathClassLoader)）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">分析Android中的ClassLoader：</span></span><br><span class="line"><span class="string">    1.java中的ClassLoader 和 Android的ClassLoader 是不一样</span></span><br><span class="line"><span class="string">    2.ClassLoader == PathClassLoader</span></span><br><span class="line"><span class="string">    3.PathClassLoader == cl.loadClass(className).newInstance();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PathClassLoader.loadClass  ---》 BaseDexClassLoader --》ClassLoader.loadClass--findClass(空方法) 让覆盖的子类方法去完成 --》</span></span><br><span class="line"><span class="string">BaseDexClassLoader.findClass() ---》pathList.findClass</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">BaseDexClassLoader.findClass() -- c 为什么为null，--》 DexPathList.findClass(className) ---》DexFile.loadClassBinaryName（系列步骤后 NDK）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for遍历 dexElements == Element[] ，分析 Element 是什么 ，为什么Element.dexFile==null?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Android虚拟机 dex文件的  dex == 对Dex表现形式的描述  Element  ---  dexFile拥有可执行</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">为什么 Element ==null?</span></span><br><span class="line"><span class="string">答：就是因为类加载机制加载的是  ---》 宿主的 classes.dex--Elements，   【没有插件的Element】</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">解决方案：把插件的dexElements 和 宿主中的 dexElements 融为一体  PathClassLoader 就能加载到 插件/宿主  都可以加载到了</span></span><br><span class="line"><span class="string">Hook式 插件化	</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------ Android ClassLoader介绍</span></span><br><span class="line"><span class="string">1.java中的ClassLoader 和 Android的ClassLoader 是不一样</span></span><br><span class="line"><span class="string">2.Android中的ClassLoader 分为两类：系统提供的ClassLoader ---》BootClassLoader，PathClassLoader，DexClassLoader</span></span><br><span class="line"><span class="string">                                  自定义ClassLoader</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">给系统预加载使用的 ：BootClassLoader</span></span><br><span class="line"><span class="string">给程序/系统程序/应用程序 加载class的 PathClassLoader</span></span><br><span class="line"><span class="string">加载 apk zip apk文件 DexClassLoader</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.内核启动 ...</span></span><br><span class="line"><span class="string">2.init第一个进程</span></span><br><span class="line"><span class="string">3.zygote进程</span></span><br><span class="line"><span class="string">  // 启动是很早就要启动</span></span><br><span class="line"><span class="string">  ---&gt; zygoteInit --&gt; BootClassLoader.getInstance();     handleSystemServerProcess PathClassLoaderFactory --》PathClassLoader</span></span><br><span class="line"><span class="string">4.zygote进程孵化 SystemServer</span></span><br><span class="line"><span class="string">5.SystemServer启动很多的服务 ---（AMS，PSM，...）</span></span><br><span class="line"><span class="string">// 不能在这里启动</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>宿主和插件融为一体，解决插件没有宿主环境等问题 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一步：找到宿主 dexElements 得到此对象     PathClassLoader代表是宿主</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二步：找到插件 dexElements 得到此对象，代表插件 DexClassLoader--代表插件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三步：创建出 新的 newDexElements []，类型必须是Element，必须是数组对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第四步：宿主dexElements + 插件dexElements =----&gt; 融合  新的 newDexElements for遍历</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第五步：把新的 newDexElements，设置到宿主中去</span></span><br><span class="line"></span><br><span class="line">以上操作，就可以去加载插件里面的<span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">需要去加载插件里面的 <span class="title">layout</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">StringBlock</span> ---》 <span class="title">string</span>.<span class="title">xml</span>  <span class="title">color</span>.<span class="title">xml</span>   <span class="title">anim</span>.<span class="title">xml</span> ...</span></span><br><span class="line"><span class="class"></span></span><br><span class="line">mStringBlocks[] ==  string.xml  color.xml   anim.xml</span><br><span class="line"></span><br><span class="line">只有mStringBlocks[] 初始化了，才能去加载 插件里面的资源</span><br></pre></td></tr></table></figure>
</li>
<li><p>LoadedApk  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">占位式 插件化 ---》（stander标准） 在插件中必须使用 宿主的环境 appActivity   宿主context  ---》 插件</span><br><span class="line"></span><br><span class="line">Hook式 （宿主 和 插件 element 进行融合） 在插件中可以随意使用<span class="keyword">this</span>，既然式融合一起，插件可以使用到宿主的环境</span><br><span class="line">插件越多 内存中的 newDexElements 就会越大</span><br><span class="line"></span><br><span class="line">LoadedApk式 插件化框架的手写，我们控制 ClassLoader</span><br><span class="line">PathClassLoader ---&gt; 宿主的<span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="class">自定义<span class="title">ClassLoader</span> --》 插件的<span class="title">class</span></span></span><br><span class="line"><span class="class">解决这个问题：插件越多 内存中的 <span class="title">newDexElements</span> 就会越大</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">ActivityThread</span>源码的分析：</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">startActivity</span> ---》 <span class="title">Activity</span> --》<span class="title">Instrumentation</span> ---&gt; <span class="title">AMS</span>检查 --》</span></span><br><span class="line"><span class="class"><span class="title">ActivityThread</span> -- <span class="title">mH</span> <span class="title">LAUNCH_ACTIVITY</span>(自己处理<span class="title">LoaderApk</span>中的<span class="title">ClassLoader</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line">                case LAUNCH_ACTIVITY: &#123;</span><br><span class="line">                    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityStart"</span>);</span><br><span class="line">                    <span class="comment">// 跳转的Activity纪录 --》</span></span><br><span class="line">                    <span class="keyword">final</span> ActivityClientRecord r = (ActivityClientRecord) msg.obj;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 如果缓存mPackages中有LoadedApk 就直接返回，如果没有LoaaedApk就创建出LoadedApk ---》 宿主的LoadedApk.ClassLoader</span></span><br><span class="line">                    <span class="comment">// 如果是加载插件，从mPackages取出 插件专用的LoadedApk.自定义ClassLoader</span></span><br><span class="line">                    r.packageInfo = getPackageInfoNoCheck(</span><br><span class="line">                            r.activityInfo.applicationInfo, r.compatInfo);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 真正的即将 实例化Activity 然后进行启动</span></span><br><span class="line">                    handleLaunchActivity(r, <span class="keyword">null</span>, <span class="string">"LAUNCH_ACTIVITY"</span>);</span><br><span class="line">                    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</span><br><span class="line">                &#125; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>.<span class="keyword">public</span> <span class="keyword">final</span> LoadedApk getPackageInfoNoCheck == 宿主的</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.缓存中的 <span class="keyword">final</span> ArrayMap&lt;String, WeakReference&lt;LoadedApk&gt;&gt; mPackages 默认保存的是宿主的LoadedApk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LoadedApk   ---  宿主的   ----》 LoadedApk.ClassLoader ---&gt; 宿主中的<span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="class"><span class="title">java</span>.<span class="title">lang</span>.<span class="title">ClassLoader</span> <span class="title">cl</span> </span>= r.packageInfo.getClassLoader(); <span class="comment">// LoadedApk里面的ClassLoader</span></span><br><span class="line">(Activity)cl.loadClass(className).newInstance(); 实例化的Activity  --》 宿主的 LoadedApk里面的ClassLoader 去实例化的</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以上代码结论：宿主的LoadedApk.ClassLoader 去加载 宿主中的<span class="class"><span class="keyword">class</span>，然后实例化的</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">--- &gt; 自定义一个<span class="title">LoadedApk</span> 自定义一个<span class="title">ClassLoader</span> 用于专门加载插件里面的<span class="title">class</span>，然后实例化</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">自定义一个 <span class="title">LoadedApk</span> 然后保存 --》 <span class="title">mPackages</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">LoadedApk</span>   ---  插件的   ----》 <span class="title">LoadedApk</span>.<span class="title">ClassLoader</span> ---&gt; 插件中的<span class="title">class</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">3.梳理流程：</span></span><br><span class="line"><span class="class">  宿主：   <span class="title">startActivity</span> ---》 <span class="title">Activity</span> --》<span class="title">Instrumentation</span> ---&gt; <span class="title">AMS</span>检查 --》<span class="title">ActivityThread</span></span></span><br><span class="line"><span class="class">           <span class="title">mPackages</span>.<span class="title">value</span>取出 <span class="title">LoadedApk</span>.<span class="title">ClassLoader</span> ---&gt; 实例化<span class="title">Activity</span>  （只能加载宿主的）</span></span><br><span class="line"><span class="class"></span></span><br><span class="line">  插件（下一节课，要完成的功能）:</span><br><span class="line">           我们在取出之前，需要自定义一个 （插件专用的 LoadedApk 自定义ClassLoader） 添加到  --》 mPackages</span><br><span class="line"></span><br><span class="line">           startActivity ---》 Activity --》Instrumentation ---&gt; AMS检查 --》ActivityThread</span><br><span class="line">           mPackages.value取出 插件专用的LoadedApk.ClassLoader --&gt; 实例化插件的Activity</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  下节课的目标：绕过 PMS 的检查处理 --&gt;</span><br><span class="line"></span><br><span class="line"> 流程：startActivity ---》 Activity --》Instrumentation ---&gt; AMS检查 --》ActivityThread --》</span><br><span class="line"></span><br><span class="line">--&gt; 获取自定义的LoadedApk.ClassLoader --&gt; 实例化  initializeJavaContextClassLoader（PMS检查要启动的包名是否安装）</span><br><span class="line"></span><br><span class="line"> --&gt;生命周期方法的处理 (才能真正启动加载到 插件包里面的Activity)</span><br><span class="line"></span><br><span class="line">PMS检测 插件包包名是否安装，如果没有安装就 会抛出异常：</span><br><span class="line">java.lang.RuntimeException: Unable to instantiate application android.app.Application: java.lang.IllegalStateException:</span><br><span class="line">Unable to get <span class="keyword">package</span> info <span class="keyword">for</span> com.netease.plugin_package; is <span class="keyword">package</span> not installed?</span><br><span class="line"></span><br><span class="line">pi = pm.getPackageInfo(mPackageName, PackageManager.MATCH_DEBUG_TRIAGED_MISSING,</span><br><span class="line">                    UserHandle.myUserId());</span><br><span class="line">Hook 我们要在 getPackageInfo 执行之前 给Hook拦截住，控制pi不为<span class="keyword">null</span></span><br><span class="line">分析：pm.getPackageInfo   客户端进程 ----》 PMS进程-检测是否安装了</span><br></pre></td></tr></table></figure>
</li>
<li><p>插件和宿主融为一体</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一步：找到宿主 dexElements 得到此对象     PathClassLoader代表是宿主</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二步：找到插件 dexElements 得到此对象，代表插件 DexClassLoader--代表插件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三步：创建出 新的 newDexElements []，类型必须是Element，必须是数组对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第四步：宿主dexElements + 插件dexElements =----&gt; 融合  新的 newDexElements for遍历</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第五步：把新的 newDexElements，设置到宿主中去</span></span><br><span class="line"></span><br><span class="line">以上操作，就可以去加载插件里面的<span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">需要去加载插件里面的 <span class="title">layout</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">StringBlock</span> ---》 <span class="title">string</span>.<span class="title">xml</span>  <span class="title">color</span>.<span class="title">xml</span>   <span class="title">anim</span>.<span class="title">xml</span> ...</span></span><br><span class="line"><span class="class"></span></span><br><span class="line">mStringBlocks[] ==  string.xml  color.xml   anim.xml</span><br><span class="line"></span><br><span class="line">只有mStringBlocks[] 初始化了，才能去加载 插件里面的资源</span><br></pre></td></tr></table></figure>
</li>
<li><p>总结 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.占位插件化 Activity  - ProxyActivity   --》插件里面，在插件开发中，必须时时刻刻记住是 是使用宿主的环境</span><br><span class="line"><span class="number">2</span>.占位插件化 Service   - ProxyService    --》插件里面，在插件开发中，必须时时刻刻记住是 是使用宿主的环境</span><br><span class="line"><span class="number">3</span>.占位插件化 动态广播   - ProxyReceiver   --》插件里面，在插件开发中，必须时时刻刻记住是 是使用宿主的环境</span><br><span class="line"><span class="number">4</span>.占位插件化 静态广播 -- 分析系统是如何解析APK文件的，源码的阅读，阅读源码的思路，PMS入手-（模仿系统是如何解析，我们就怎么解析）（难点）</span><br><span class="line">稳定，插件化开发很痛苦   -------》 开源中的框架 插件化框架 DL</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>.Hook从入门 到 熟练 --（<span class="number">1</span>.替换，<span class="number">2</span>.被替换的 动态代理/接口设置）  --&gt; Hook系统源码 -- （Hook1）AMS检测是否注册 --- （Hook2）换回来</span><br><span class="line"><span class="number">6</span>.安卓的类加载 --》PathClassLoader(加载运行App中的<span class="class"><span class="keyword">class</span>)，<span class="title">DexClassLoader</span>(<span class="title">apk</span> <span class="title">zip</span>), <span class="title">DexPathList</span> <span class="title">Element</span>，插件<span class="title">Element</span>和宿主<span class="title">Element</span></span></span><br><span class="line"><span class="class">7.真正的融合--》就可以加载插件里面的<span class="title">class</span>， 插件里面的<span class="title">Layout</span>怎么去加载呢，<span class="title">AseetManager</span> <span class="title">Resources</span>  （难点）</span></span><br><span class="line"><span class="class"><span class="title">Hook</span>式插件化框架 --》 融为一体，<span class="title">Hook</span>方式： 不用考虑宿主的环境，不稳定</span>==兼容性，  <span class="number">360</span>开源框架 Hook方式实现的</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>.LoadedApk插件化-- ActivityThread LAUNCH_ACTIVITY源码切入点，ClassLoader--》宿主 --&gt; LoadedApk.ClassLoader --&gt; 宿主<span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="class">9.自定义<span class="title">LoadedApk</span>.自定义<span class="title">ClassLoader</span> ---&gt; 插件的<span class="title">class</span>， <span class="title">mPackages</span> -- <span class="title">size</span></span>=<span class="number">2</span>  ， 没法绕过PMS检测，检测插件包名是否安装了</span><br><span class="line"><span class="number">10</span>.开关 切换 宿主 插件，    再次运行会报错，是因为 PMS检测， Hook PMS，绕过了pi==<span class="keyword">null</span>的情况</span><br><span class="line">不稳定==兼容性</span><br></pre></td></tr></table></figure>
</li>
<li><p>Hook代码推理技巧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.Hook反射处理，倒序写代码，只写一行代码，推理千万行代码</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.兼容的 <span class="number">21</span> ~ <span class="number">28</span> 系统版本 -- Hook插件化框架  手写</span><br></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/（一）-架构师入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WarriorYu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WarriorYu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/（一）-架构师入门/" itemprop="url">（一） 架构师入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T10:53:41+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/架构/" itemprop="url" rel="index">
                    <span itemprop="name">架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-架构师入门"><a href="#1-架构师入门" class="headerlink" title="1. 架构师入门"></a>1. 架构师入门</h1><h3 id="一-AOP面向切面架构设计-两种方式"><a href="#一-AOP面向切面架构设计-两种方式" class="headerlink" title="一. AOP面向切面架构设计-两种方式"></a>一. AOP面向切面架构设计-两种方式</h3><ol>
<li><p>定义：</p>
<p>在软件业，AOP为Aspect Oriented Programming的缩写，意为：<a href="https://baike.baidu.com/item/面向切面编程/6016335" target="_blank" rel="noopener">面向切面编程</a>，通过<a href="https://baike.baidu.com/item/预编译/3191547" target="_blank" rel="noopener">预编译</a>方式和运行期间动态代理实现程序功能的统一维护的一种技术。AOP是<a href="https://baike.baidu.com/item/OOP" target="_blank" rel="noopener">OOP</a>的延续，是软件开发中的一个热点，也是<a href="https://baike.baidu.com/item/Spring" target="_blank" rel="noopener">Spring</a>框架中的一个重要内容，是<a href="https://baike.baidu.com/item/函数式编程/4035031" target="_blank" rel="noopener">函数式编程</a>的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的<a href="https://baike.baidu.com/item/耦合度/2603938" target="_blank" rel="noopener">耦合度</a>降低，提高程序的可重用性，同时提高了开发的效率。</p>
</li>
<li><p>aspectj：</p>
<ul>
<li>编译时用Aspect专门的编译器，不再使用传统的javac </li>
</ul>
</li>
<li><p>aspectj相关：</p>
<ul>
<li><p>下载aspectj  地址   <a href="http://www.eclipse.org/aspectj/downloads.php" target="_blank" rel="noopener">http://www.eclipse.org/aspectj/downloads.php</a></p>
</li>
<li><p>下载aspectj的adt地址<a href="http://www.eclipse.org/ajdt/downloads/#43zips" target="_blank" rel="noopener">http://www.eclipse.org/ajdt/downloads/#43zips</a></p>
</li>
</ul>
</li>
</ol>
<ul>
<li>build.gradle  aspectJ  写法  <a href="http://fernandocejas.com/2014/08/03/aspect-oriented-programming-in-android/" target="_blank" rel="noopener">http://fernandocejas.com/2014/08/03/aspect-oriented-programming-in-android/</a></li>
</ul>
<h3 id="二-设计模式"><a href="#二-设计模式" class="headerlink" title="二. 设计模式"></a>二. 设计模式</h3><ol>
<li>MVC:  如果Activity里有线程执行耗时操作没有执行完，但是退出Activity,这时Activity不会被回收，导致内存泄漏。</li>
<li>MVP：Activity使用弱引用，当有耗时操作时，退出Activity时不会发生内存泄漏。<ul>
<li>第一种P层的实现：Google在Github开源的架构实例，M对应JavaBean，V对应Activity/Fragment, P处理业务逻辑等，所有的活都有P层干完，然后通知V更新UI。</li>
<li>第二种P层的实现：P层只做转发，M对应Model层，P转发给M层处理业务逻辑等，然后M再返回给P层，P层通  知V层更新UI。</li>
<li>第三种P层的实现：类似第二种，但是不需要Model层，让功能模块去工作（LIibrary:下载、请求、图片加载）。</li>
</ul>
</li>
<li>MVVM：<ol>
<li>缺点  <ul>
<li>虽然不用findViewById，但是view都放在一个Object数组里，Activity有很多，就有很多数组，这是第一个占用内存过多的地方。 </li>
<li>在ViewDataBinding类的static代码块里，在每个Activity都有OnAttachStateChangeListener对每个View做状态改变的监听，状态改变都会调用他的onViewAttachedToWindow方法，从该方法里能看到在ViewDataBinding类里new了Runnable，也就是创建了线程，可见Activity多的时候，会因为每个Activity都new了一个Runnable，线程过多导致内存占用过大。这是第二个占用内存的地方。</li>
<li>在ViewDataBinding类的invalidateAll()方法，还有一些其他的地方，里面使用了Handler，因为Handler绑定了Looper，每个Activity都这样，占用内存过多。这是第三个占用内存的地方。 </li>
</ul>
</li>
<li>M-&gt;V  V-&gt;M的过程解析<ul>
<li>ViewDataBinding类的static快里，执行了binding.mRebindRunnable.run();跟着方法走，可以看到executePendingBindings() -&gt;executeBindingsInternal() -&gt;executeBindings()，executeBindings这个方法在ActivityMainBindingImpl实现，里面可以跟踪看到M更新V，V更新M。 </li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="三-Android-系统源码"><a href="#三-Android-系统源码" class="headerlink" title="三. Android 系统源码"></a>三. Android 系统源码</h3><h4 id="1-Handler-为什么在子线程可以使用textView-setText-不报错，使用Toast报错。"><a href="#1-Handler-为什么在子线程可以使用textView-setText-不报错，使用Toast报错。" class="headerlink" title="1. Handler: 为什么在子线程可以使用textView.setText() 不报错，使用Toast报错。"></a>1. Handler: 为什么在子线程可以使用textView.setText() 不报错，使用Toast报错。</h4><ul>
<li><p>首先这个问题不是绝对的，如果在textView.setText() 之前sleep几秒，同样会报错。</p>
</li>
<li><p>因为setText()方法的过程中，会在ViewRootImpl类中执行一个checkThread方法，来检查当前线程和创建ViewRootImpl时的线程是不是同一个线程；而ViewRootImpl的创建是在onResume方法中初始化的，而我们开启的子线程是在onCreat方法中，这个时候程序没有去检测当前线程是不是主线程，所以没有抛异常。因为Toast也有setText方法，但是在这个方法之前还有一些其他操作，等执行到检查线程的方法时，ViewRootImpl已经初始化好了。如果我们在TextView.setText之前sleep一秒，就会报错，因为ViewRootImpl已经初始化好了，会检查线程。</p>
</li>
</ul>
<h4 id="2-Binder"><a href="#2-Binder" class="headerlink" title="2.Binder"></a>2.Binder</h4><p>​    1.  Binder可以实现进程与进程之间的通信。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/（三）Glide的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WarriorYu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WarriorYu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/（三）Glide的使用/" itemprop="url">（三）Glide的使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T10:50:29+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android源码分析/" itemprop="url" rel="index">
                    <span itemprop="name">Android源码分析</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Glide-记录"><a href="#Glide-记录" class="headerlink" title="Glide 记录"></a>Glide 记录</h2><ol>
<li><p>Android SDK 要求 </p>
<p><strong>Min Sdk Version</strong> - 使用 Glide 需要 min SDK 版本 API <strong>14</strong> (Ice Cream Sandwich) 或更高。</p>
<p><strong>Compile Sdk Version</strong> - Glide 必须使用 API <strong>27</strong> (Oreo MR1) 或更高版本的 SDK 来编译。</p>
<p><strong>Support Library Version</strong> - Glide 使用的支持库版本为 <strong>27</strong>。</p>
<p>如果你需要使用不同的支持库版本，你需要在你的 <code>build.gradle</code> 文件里去从 Glide 的依赖中去除 <code>&quot;com.android.support&quot;</code>。例如，假如你想使用 v26 的支持库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  implementation (&quot;com.github.bumptech.glide:glide:4.8.0&quot;) &#123;</span><br><span class="line">    exclude group: &quot;com.android.support&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  implementation &quot;com.android.support:support-fragment:26.1.0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>多数情况下，使用Glide加载图片非常简单，一行代码足矣：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(fragment)</span><br><span class="line">    .load(myUrl)</span><br><span class="line">    .into(imageView);</span><br></pre></td></tr></table></figure>
<p>取消加载同样很简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(fragment).clear(imageView);</span><br></pre></td></tr></table></figure>
<p>尽管及时取消不必要的加载是很好的实践，但这并不是必须的操作。实际上，当 <a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/Glide.html#with-android.app.Fragment-" target="_blank" rel="noopener"><code>Glide.with()</code></a> 中传入的 Activity 或 Fragment 实例销毁时，Glide 会自动取消加载并回收资源。  </p>
</li>
<li><p>在 ListView 和 RecyclerView 中的使用</p>
<p>在 ListView 或 RecyclerView 中加载图片的代码和在单独的 View 中加载完全一样。Glide 已经自动处理了 View 的复用和请求的取消。对 url 进行 null 检验并不是必须的，如果 url 为 null，Glide 会清空 View 的内容，或者显示 <a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/request/RequestOptions.html#placeholder-int-" target="_blank" rel="noopener">placeholder Drawable</a> 或 <a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/request/RequestOptions.html#fallback-int-" target="_blank" rel="noopener">fallback Drawable</a> 的内容。</p>
</li>
<li><p>Glide允许用户指定三种不同类型的占位符，分别在三种不同场景使用：</p>
<ul>
<li><a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/request/RequestOptions.html#placeholder-int-" target="_blank" rel="noopener">placeholder</a></li>
<li><a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/request/RequestOptions.html#error-int-" target="_blank" rel="noopener">error</a></li>
<li><a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/request/RequestOptions.html#fallback-int-" target="_blank" rel="noopener">fallback</a></li>
</ul>
</li>
<li><p>请求选项</p>
<p>Glide中的大部分设置项都可以通过 <a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/request/RequestOptions.html" target="_blank" rel="noopener"><code>RequestOptions</code></a> 类和 <a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/RequestBuilder.html#apply-com.bumptech.glide.request.RequestOptions-" target="_blank" rel="noopener"><code>apply()</code></a> 方法来应用到程序中。</p>
<p>使用 <code>request options</code> 可以实现（包括但不限于）：</p>
<ul>
<li>占位符(<code>Placeholders</code>)</li>
<li>转换(<code>Transformations</code>)</li>
<li>缓存策略(<code>Caching Strategies</code>)</li>
<li>组件特有的设置项，例如编码质量，或<code>Bitmap</code>的解码配置等。 </li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="WarriorYu" />
            
              <p class="site-author-name" itemprop="name">WarriorYu</p>
              <p class="site-description motion-element" itemprop="description">Stay Hungry. Stay Foolish.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/WarriorYu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="soldieryu.dev@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WarriorYu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
